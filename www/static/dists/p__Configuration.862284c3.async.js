(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[27],{"s+T3":function(e,t,a){"use strict";var n=a("tAuX"),i=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,o,s,l=n(a("q1tI")),c=a("MuoO"),u=i(a("QDog")),d=i(a("hMqj")),p=i(a("nckk")),f=i(a("zmNr")),m=a("vSx2"),g=(r=(0,c.connect)(e=>{var t=e.teamControl,a=e.enterprise;return{currentTeam:t.currentTeam,currentRegionName:t.currentRegionName,currentEnterprise:a.currentEnterprise,currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}}),r((s=class extends l.PureComponent{constructor(e){super(e),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return d.default.querySpecifiedPermissionsInfo(t,e)}),this.state={appConfigGroupPermissions:this.handlePermissions("queryAppConfigGroupInfo")}}componentWillMount(){var e=this.props.dispatch,t=this.state.appConfigGroupPermissions.isAccess;t||u.default.withoutPermission(e)}render(){var e=this.props,t=e.currentEnterprise,a=e.currentTeam,n=e.currentRegionName,i=e.match,r=this.state.appConfigGroupPermissions,o=i.params,s=o.teamName,c=o.regionName,u=o.appID,d={regionName:c,teamName:s,appID:u,appConfigGroupPermissions:r},g=[];return g=(0,m.createTeam)((0,m.createEnterprise)(g,t),a,n),l.default.createElement(p.default,{breadcrumbList:g},l.default.createElement(f.default,d))}},o=s))||o);t.default=g},zmNr:function(e,t,a){"use strict";var n=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var r=n(a("bx4M"));a("g9YV");var o=n(a("wCAj"));a("Awhp");var s=n(a("KrTs"));a("Q9mQ");var l=n(a("diRs"));a("14J3");var c=n(a("BMrR"));a("+L6B");var u=n(a("2/Rp"));a("5NDa");var d=n(a("5rEg"));a("/xke");var p=n(a("TeRw"));a("y8nQ");var f=n(a("Vl3Y"));a("2qtc");var m,g,h,C=n(a("kLXV")),v=n(a("q76B")),b=a("xpXo"),M=a("MuoO"),E=a("7DNP"),_=n(a("wd/R")),I=i(a("q1tI")),y=a("LLXN"),D=C.default.confirm,N=f.default.Item,P=(m=(0,M.connect)(e=>{var t=e.loading,a=e.teamControl,n=e.enterprise;return{deleteConfigurationLoading:t.effects["global/DeleteConfiguration"],currentTeam:a.currentTeam,currentRegionName:a.currentRegionName,currentEnterprise:n.currentEnterprise,currentTeamPermissionsInfo:a.currentTeamPermissionsInfo}}),m((h=class extends I.PureComponent{constructor(e){var t;super(e),t=this,this.onPageChange=(e=>{this.setState({page:e},()=>{this.fetchConfigurationList()})}),this.fetchConfigurationList=(()=>{var e=this.props,t=e.dispatch,a=e.teamName,n=e.regionName,i=e.appID,r=this.state,o=r.page,s=r.pageSize,l=r.query;t({type:"global/fetchConfigurationList",payload:{team_name:a,group_id:i,region:n,query:l,page:o,page_size:s},callback:e=>{e&&200===e.status_code&&this.setState({loading:!1,apps:e.list,total:e.total})}})}),this.handleConfigurationOperation=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=t.props,n=a.dispatch,i=a.regionName,r=a.teamName,o=a.appID,s=e?e.config_group_name:"add";n(E.routerRedux.push("/team/".concat(r,"/region/").concat(i,"/apps/").concat(o,"/configgroups/details/").concat(s)))},this.handleSearch=(()=>{this.fetchConfigurationList()}),this.handelChange=(e=>{this.setState({query:e.target.value})}),this.handleEnter=(()=>{this.handleSearch()}),this.handleDelete=(e=>{this.setState({deleteVar:!0,info:e})}),this.cancelDeleteVariabl=(()=>{this.setState({deleteVar:!1})}),this.handleResetInfo=(()=>{this.setState({info:{}})}),this.handleDeleteVariabl=(()=>{var e=this.props,t=e.dispatch,a=e.regionName,n=e.teamName,i=e.appID,r=this.state,o=r.page,s=r.pageSize,l=r.query,c=r.info,u=[];c&&c.services&&c.services.length>0&&c.services.map(e=>{u.push(e.service_id)}),t({type:"global/DeleteConfiguration",payload:{region_name:a,team_name:n,group_id:i,name:c.config_group_name,query:l,page:o,page_size:s},callback:e=>{e&&200===e.status_code&&(this.fetchConfigurationList(),this.cancelDeleteVariabl(),u.length>0?this.showRemind(u):this.handleResetInfo(),p.default.success({message:(0,y.formatMessage)({id:"notification.success.delete"})}))}})}),this.showRemind=(e=>{var t=this;D({title:(0,y.formatMessage)({id:"notification.hint.confiuration.update.title"}),content:(0,y.formatMessage)({id:"notification.hint.confiuration.update.content"}),okText:(0,y.formatMessage)({id:"button.update"}),cancelText:(0,y.formatMessage)({id:"button.cancel"}),onOk(){return t.handleBatchOperation(e),new Promise((e,t)=>{setTimeout(Math.random()>.5?e:t,2e3)}).catch(()=>console.log("Oops errors!"))},onCancel(){t.handleResetInfo()}})}),this.handleBatchOperation=(e=>{var t=this.props.teamName;(0,b.batchOperation)({action:"upgrade",team_name:t,serviceIds:e&&e.length>0?e.join(","):""}).then(e=>{e&&(p.default.success({message:(0,y.formatMessage)({id:"notification.success.updates"}),duration:"3"}),this.handleResetInfo())})}),this.state={apps:[],loading:!0,page:1,query:"",pageSize:10,info:{},deleteVar:!1}}componentDidMount(){this.fetchConfigurationList()}render(){var e=this.props,t=e.deleteConfigurationLoading,a=e.appConfigGroupPermissions,n=a.isCreate,i=a.isDelete,p=a.isEdit,m=e.regionName,g=e.teamName,h=(e.appID,this.state),C=h.apps,b=h.loading,M=h.page,D=h.pageSize,P=h.total,k=h.deleteVar;return I.default.createElement("div",null,I.default.createElement(c.default,null,I.default.createElement(f.default,{layout:"inline",style:{display:"inline-block"}},I.default.createElement(N,null,I.default.createElement(d.default,{placeholder:(0,y.formatMessage)({id:"appConfiguration.placeholder"}),onChange:this.handelChange,onPressEnter:this.handleEnter,style:{width:250}})),I.default.createElement(N,null,I.default.createElement(u.default,{type:"primary",onClick:this.handleSearch,icon:"search"},(0,y.formatMessage)({id:"appConfiguration.btn.search"})))),n&&I.default.createElement(u.default,{type:"primary",icon:"plus",style:{float:"right",marginBottom:"20px"},onClick:()=>{this.handleConfigurationOperation()}},(0,y.formatMessage)({id:"appConfiguration.btn.add"}))),k&&I.default.createElement(v.default,{onOk:this.handleDeleteVariabl,onCancel:this.cancelDeleteVariabl,loading:t,title:(0,y.formatMessage)({id:"confirmModal.delete.configuration.title"}),desc:(0,y.formatMessage)({id:"confirmModal.delete.configuration.desc"}),subDesc:(0,y.formatMessage)({id:"confirmModal.delete.strategy.subDesc"})}),I.default.createElement(r.default,{loading:b},I.default.createElement(o.default,{size:"default",pagination:{size:"default",current:M,pageSize:D,total:P,onChange:this.onPageChange},dataSource:C||[],columns:[{title:(0,y.formatMessage)({id:"appConfiguration.table.name"}),dataIndex:"config_group_name"},{title:(0,y.formatMessage)({id:"appConfiguration.table.createTime"}),dataIndex:"create_time",align:"center",render:e=>{return"".concat((0,_.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))}},{title:(0,y.formatMessage)({id:"appConfiguration.table.componentNum"}),dataIndex:"services_num",align:"center",render:(e,t)=>{return I.default.createElement("div",null,e?I.default.createElement(l.default,{placement:"top",title:(0,y.formatMessage)({id:"appConfiguration.table.take_effect_component"}),content:I.default.createElement("div",null,t.services.map(e=>{var t=e.service_cname,a=e.service_alias;return I.default.createElement(E.Link,{key:a,to:"/team/".concat(g,"/region/").concat(m,"/components/").concat(a,"/overview")},t)})),trigger:"click"},I.default.createElement("a",null,e)):0)}},{title:(0,y.formatMessage)({id:"appConfiguration.table.status"}),dataIndex:"enable",align:"center",render:e=>{return I.default.createElement("div",null,I.default.createElement(s.default,{status:e?"success":"error",text:I.default.createElement("span",null,e?(0,y.formatMessage)({id:"appConfiguration.table.take_effect"}):(0,y.formatMessage)({id:"appConfiguration.table.not_take_effect"}))}))}},{title:(0,y.formatMessage)({id:"appConfiguration.table.operate"}),dataIndex:"action",align:"center",render:(e,t)=>{return I.default.createElement("div",null,p&&I.default.createElement("a",{onClick:()=>{this.handleConfigurationOperation(t)}},(0,y.formatMessage)({id:"appConfiguration.table.btn.edit"})),i&&I.default.createElement("a",{onClick:()=>{this.handleDelete(t)}},(0,y.formatMessage)({id:"appConfiguration.table.btn.delete"})))}}]})))}},g=h))||g);t.default=P}}]);