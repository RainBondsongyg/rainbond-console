(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[57],{UHeB:function(e,t,a){"use strict";var s=a("g09b"),o=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var i=s(a("bx4M"));a("g9YV");var r=s(a("wCAj"));a("/xke");var l=s(a("TeRw")),p=s(a("p0pE"));a("2qtc");var n=s(a("kLXV"));a("Mwp2");var u=s(a("VXEj"));a("fOrg");var c=s(a("+KLJ")),d=s(a("jehZ"));a("5Dmo");var m=s(a("3S7+"));a("+L6B");var h=s(a("2/Rp"));a("y8nQ");var g=s(a("Vl3Y"));a("Pwec");var f=s(a("CtXQ"));a("7Kak");var k=s(a("9yH6"));a("5NDa");var b,v,B,M,_,E,S,w,y,I=s(a("5rEg")),C=a("MuoO"),D=a("7DNP"),L=o(a("q1tI")),R=a("LLXN"),x=s(a("nyIC")),T=s(a("q76B")),N=s(a("e6Ls")),P=s(a("deV3")),O=s(a("D+Pu")),A=s(a("br/n")),z=s(a("puxM")),U=s(a("XZXw")),G=a("vSx2"),X=s(a("QDog")),q=s(a("ym8O")),V=s(a("hMqj")),j=s(a("ZgmS")),J=s(a("8+Sn")),Q=s(a("+iC2")),Z=I.default.TextArea,F=k.default.Button,K=k.default.Group,W=(b=(0,C.connect)(e=>{var t=e.user;return{currUser:t.currentUser}}),b((B=class extends L.PureComponent{constructor(e){super(e),this.getSocketUrl=(()=>{return Q.default.getCurrRegionSoketUrl(this.props.currUser)}),this.state={map:{starting:(0,R.formatMessage)({id:"status.app.backups.backuping"}),success:(0,R.formatMessage)({id:"status.app.backups.error"}),failed:(0,R.formatMessage)({id:"status.app.backups.success"})}},this.timer=null}componentDidMount(){var e=this.props.data;"starting"===e.status&&(this.createSocket(),this.startLoopStatus())}componentWillUnmount(){this.stopLoopStatus(),this.logSocket&&this.logSocket.destroy(),this.logSocket=null}createSocket(){this.logSocket=new q.default({url:this.getSocketUrl(),eventId:this.props.data.event_id,onMessage:e=>{}})}startLoopStatus(){this.props.dispatch({type:"application/fetchBackupStatus",payload:{team_name:X.default.getCurrTeamName(),backup_id:this.props.data.backup_id,group_id:this.props.group_id},callback:e=>{if(e){var t=e.bean;"starting"===t.status?this.timer=setTimeout(()=>{this.startLoopStatus()},1e4):this.props.onEnd&&this.props.onEnd()}}})}stopLoopStatus(){clearTimeout(this.timer)}render(){var e=this.props.data||{};return L.default.createElement("span",null,this.state.map[e.status],"starting"===e.status&&L.default.createElement(f.default,{style:{marginLeft:8},type:"loading",spin:!0}))}},v=B))||v),H=(M=g.default.create(),M((E=class extends L.PureComponent{constructor(){super(...arguments),this.state={},this.onOk=(e=>{e.preventDefault();var t=this.props,a=t.form,s=t.onOk,o=t.warningText;a.validateFields((e,t)=>{if(!e){var a=t;o&&(a.force=!0),s&&s(a)}})})}render(){var e=this.props,t=e.data,a=void 0===t?{}:t,s=e.form,o=e.is_configed,i=e.componentList,r=e.warningText,l=e.onCancel,p=e.loading,f=void 0!==p&&p,k=s.getFieldDecorator,b={labelCol:{span:5},wrapperCol:{span:19}},v=o?(0,R.formatMessage)({id:"appBackups.table.pages.is_configed"}):(0,R.formatMessage)({id:"appBackups.table.pages.no_configed"});return L.default.createElement(n.default,{title:(0,R.formatMessage)({id:"appBackups.btn.addBackups"}),visible:!0,className:N.default.TelescopicModal,onOk:this.onOk,onCancel:l,footer:[L.default.createElement(h.default,{onClick:l}," ",(0,R.formatMessage)({id:"popover.cancel"})," "),L.default.createElement(h.default,{type:"primary",onClick:this.onOk,loading:f},r?(0,R.formatMessage)({id:"button.forced_backup"}):(0,R.formatMessage)({id:"popover.confirm"}))]},L.default.createElement(g.default,{layout:"horizontal"},L.default.createElement(g.default.Item,(0,d.default)({},b,{label:L.default.createElement("span",null,(0,R.formatMessage)({id:"appBackups.table.pages.label.mode"}))}),k("mode",{initialValue:o?a.mode||"full-online":"full-offline",rules:[{required:!0,message:(0,R.formatMessage)({id:"placeholder.app_not_name"})}]})(L.default.createElement(K,null,L.default.createElement(m.default,{title:v},L.default.createElement(F,{disabled:!o,value:"full-online"},(0,R.formatMessage)({id:"appBackups.table.pages.label.full-online"}))),L.default.createElement(m.default,{title:(0,R.formatMessage)({id:"appBackups.table.pages.label.tooltip.title"})},L.default.createElement(F,{value:"full-offline"},(0,R.formatMessage)({id:"appBackups.table.pages.label.full-offline"})))))),L.default.createElement(g.default.Item,(0,d.default)({},b,{label:(0,R.formatMessage)({id:"appBackups.table.pages.label.note"})}),k("note",{initialValue:a.note||"",rules:[{required:!0,message:(0,R.formatMessage)({id:"placeholder.backup.note"})}]})(L.default.createElement(Z,{placeholder:(0,R.formatMessage)({id:"placeholder.backup.note"})}))),r&&L.default.createElement("div",null,L.default.createElement(c.default,{message:r,type:"warning"}),L.default.createElement(u.default,{size:"small",style:{margin:"10px 0"},header:L.default.createElement("h6",{style:{marginBottom:"0",fontSize:"15px"}},(0,R.formatMessage)({id:"appDynamic.table.componentName"})),bordered:!0,dataSource:i,renderItem:e=>L.default.createElement(u.default.Item,null,e)}))))}},_=E))||_),Y=(S=(0,C.connect)(e=>{var t=e.user,a=e.global,s=e.teamControl,o=e.enterprise;return{currUser:t.currentUser,groups:a.groups||[],currentTeam:s.currentTeam,currentRegionName:s.currentRegionName,currentEnterprise:o.currentEnterprise,currentTeamPermissionsInfo:s.currentTeamPermissionsInfo}}),S((y=class extends L.PureComponent{constructor(e){super(e),this.onBackup=(()=>{this.setState({showBackup:!0})}),this.getGroupId=(()=>{var e=this.props.match.params;return e.appID}),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return V.default.querySpecifiedPermissionsInfo(t,e)}),this.fetchBackup=(()=>{var e=this.props.match.params,t=e.teamName,a=e.appID;this.props.dispatch({type:"application/fetchBackup",payload:{team_name:t,group_id:a,page:this.state.page,page_size:this.state.pageSize},callback:e=>{e&&this.setState({list:e.list||[],total:e.total,is_configed:e.bean.is_configed})}})}),this.cancelBackup=(()=>{this.setState({showBackup:!1,warningText:"",componentList:[],loading:!1})}),this.cancelLoading=(()=>{this.setState({loading:!1})}),this.handleBackup=(e=>{this.setState({loading:!0}),this.props.dispatch({type:"application/backup",payload:(0,p.default)({team_name:X.default.getCurrTeamName(),group_id:this.getGroupId()},e),callback:()=>{this.cancelBackup(),this.fetchBackup()},handleError:e=>{if(e&&e.data&&e.data.code){var t=e.data.code;4122===t||4121===t?this.setState({warningText:4122===t?(0,R.formatMessage)({id:"appBackups.table.pages.abnormal.custom"}):(0,R.formatMessage)({id:"appBackups.table.pages.abnormal.not_stop"}),componentList:e.data.data.list||[]}):e.data.msg_show&&l.default.warning({message:e.data.msg_show})}this.cancelLoading()}})}),this.fetchAppDetail=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.teamName,s=t.regionName,o=t.appID;this.setState({loadingDetail:!0}),e({type:"application/fetchGroupDetail",payload:{team_name:a,region_name:s,group_id:o},callback:e=>{e&&200===e.status_code&&this.setState({appDetail:e.bean,loadingDetail:!1})},handleError:e=>{e&&404===e.code&&this.props.dispatch(D.routerRedux.push("/team/".concat(X.default.getCurrTeamName(),"/region/").concat(X.default.getCurrRegionName(),"/apps")))}})}),this.toAdd=(()=>{this.setState({showImport:!0})}),this.handleImportBackup=(()=>{l.default.success({message:(0,R.formatMessage)({id:"status.app.backups.imported"}),duration:2}),this.setState({showImport:!1}),this.fetchBackup()}),this.cancelImportBackup=(()=>{this.setState({showImport:!1}),this.fetchBackup()}),this.handleRecovery=(e=>{this.setState({showRecovery:!0,backup_id:e.backup_id,group_uuid:e.group_uuid})}),this.handleRecoveryBackup=(()=>{this.setState({showRecovery:!1,backup_id:""}),this.fetchBackup()}),this.cancelRecoveryBackup=(()=>{this.setState({showRecovery:!1,backup_id:""}),this.fetchBackup()}),this.handleMove=(e=>{this.setState({showMove:!0,backup_id:e.backup_id,group_uuid:e.group_uuid,moveBackupMode:e.mode})}),this.handleMoveBackup=(()=>{this.setState({showMove:!1})}),this.cancelMoveBackup=(()=>{this.setState({showMove:!1,backup_id:""})}),this.handleExport=(e=>{var t="".concat(x.default.baseUrl,"/console/teams/").concat(X.default.getCurrTeamName(),"/groupapp/").concat(this.getGroupId(),"/backup/export?backup_id=").concat(e.backup_id);window.open(t),l.default.success({message:(0,R.formatMessage)({id:"status.app.backups.yolkStroke"}),duration:2})}),this.handleDel=(e=>{this.setState({showDel:!0,backup_id:e.backup_id})}),this.handleDelete=(()=>{this.setState({deleteLoading:!0}),this.props.dispatch({type:"application/delBackup",payload:{team_name:X.default.getCurrTeamName(),group_id:this.getGroupId(),backup_id:this.state.backup_id},callback:e=>{e&&(l.default.success({message:(0,R.formatMessage)({id:"notification.success.delete"}),duration:2}),this.cancelDelete(),this.fetchBackup())}})}),this.cancelDelete=(()=>{this.setState({showDel:!1,backup_id:"",deleteLoading:!1},()=>{this.fetchBackup()})}),this.jumpToAllbackup=(()=>{this.props.dispatch(D.routerRedux.push("/team/".concat(X.default.getCurrTeamName(),"/region/").concat(X.default.getCurrRegionName(),"/allbackup")))}),this.state={list:[],page:1,total:0,pageSize:6,showBackup:!1,showMove:!1,showDel:!1,showRecovery:!1,showImport:!1,backup_id:"",appDetail:{},is_configed:null,group_uuid:"",warningText:"",componentList:[],operationPermissions:this.handlePermissions("queryAppInfo"),loading:!1,deleteLoading:!1,language:"zh-CN"===J.default.get("language")}}componentWillMount(){var e=this.props.dispatch,t=this.state.operationPermissions.isBackup;t||X.default.withoutPermission(e)}componentDidMount(){this.fetchAppDetail(),this.fetchBackup()}render(){var e=this.props,t=e.currentEnterprise,a=e.currentTeam,s=e.currentRegionName,o=this.props.match.params.regionName,l=this.state,p=l.appDetail,n=l.loadingDetail,u=l.list,c=void 0===u?[]:u,d=l.operationPermissions,m=d.isMigrate,g=d.isImport,f=d.isExport,k=l.loading,b=l.deleteLoading,v=l.language,B=[{title:(0,R.formatMessage)({id:"appBackups.table.backupsTime"}),dataIndex:"create_time"},{title:(0,R.formatMessage)({id:"appBackups.table.backupsPerson"}),dataIndex:"user"},{title:(0,R.formatMessage)({id:"appBackups.table.backupsPattern"}),dataIndex:"mode",render:e=>{var t={"full-online":(0,R.formatMessage)({id:"appBackups.table.backupsPattern.cloud"}),"full-offline":(0,R.formatMessage)({id:"appBackups.table.backupsPattern.local"})};return t[e]||""}},{title:(0,R.formatMessage)({id:"appBackups.table.packetSize"}),dataIndex:"backup_size",render:e=>{return j.default.unit(e,"Byte")}},{title:(0,R.formatMessage)({id:"appBackups.table.status"}),dataIndex:"status",render:(e,t)=>{return L.default.createElement(W,{onEnd:this.fetchBackup,group_id:this.getGroupId(),data:t})}},{title:(0,R.formatMessage)({id:"appBackups.table.comment"}),dataIndex:"note"},{title:(0,R.formatMessage)({id:"appBackups.table.operate"}),dataIndex:"action",render:(e,t)=>{var a="success"===t.status,s=m&&a,o="full-online"===t.mode&&a&&f,i=(e,a)=>{return L.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this[a](t)}},e)};return L.default.createElement("div",null,s&&L.default.createElement(L.Fragment,null,i((0,R.formatMessage)({id:"appBackups.table.btn.recover"}),"handleRecovery"),i((0,R.formatMessage)({id:"appBackups.table.btn.removal"}),"handleMove")),o&&i((0,R.formatMessage)({id:"appBackups.table.btn.export"}),"handleExport"),i((0,R.formatMessage)({id:"appBackups.table.btn.delete"}),"handleDel"))}}],M=[];return M=(0,G.createApp)((0,G.createTeam)((0,G.createEnterprise)(M,t),a,s),a,s,{appName:p.group_name,appID:p.group_id}),L.default.createElement(U.default,{loading:n,breadcrumbList:M,title:(0,R.formatMessage)({id:"appBackups.title"}),content:L.default.createElement("p",null,(0,R.formatMessage)({id:"appBackups.desc"})),extraContent:L.default.createElement("div",{style:v?{}:{display:"flex"}},L.default.createElement(h.default,{style:v?{marginRight:8}:{marginRight:8,padding:6},type:"primary",onClick:this.onBackup},(0,R.formatMessage)({id:"appBackups.btn.addBackups"})),g&&L.default.createElement(h.default,{style:v?{marginRight:8}:{marginRight:8,padding:6},onClick:this.toAdd},(0,R.formatMessage)({id:"appBackups.btn.importBackups"})),L.default.createElement(h.default,{onClick:this.jumpToAllbackup,style:v?{}:{padding:6}},(0,R.formatMessage)({id:"appBackups.btn.allBackups"})))},L.default.createElement(i.default,null,L.default.createElement(z.default,{sm:800},L.default.createElement(r.default,{rowKey:e=>{return e.backup_id},pagination:{current:this.state.page,total:this.state.total,pageSize:this.state.pageSize,onChange:e=>{this.setState({page:e},()=>{this.fetchBackup()})}},columns:B,dataSource:c}))),this.state.showBackup&&L.default.createElement(H,{warningText:this.state.warningText,componentList:this.state.componentList,is_configed:this.state.is_configed,onOk:this.handleBackup,onCancel:this.cancelBackup,loading:k}),this.state.showMove&&L.default.createElement(O.default,{onOk:this.handleMoveBackup,onCancel:this.cancelMoveBackup,backupId:this.state.backup_id,groupId:this.getGroupId(),currentRegion:o,mode:this.state.mode,group_uuid:this.state.group_uuid,moveBackupMode:this.state.moveBackupMode}),this.state.showRecovery&&L.default.createElement(A.default,{onOk:this.handleRecoveryBackup,onCancel:this.cancelRecoveryBackup,propsParams:this.props.match.params,backupId:this.state.backup_id,group_uuid:this.state.group_uuid,groupId:this.getGroupId()}),this.state.showImport&&L.default.createElement(P.default,{onReLoad:this.handleImportBackup,onCancel:this.cancelImportBackup,backupId:this.state.backup_id,groupId:this.getGroupId()}),this.state.showDel&&L.default.createElement(T.default,{backupId:this.state.backup_id,onOk:this.handleDelete,onCancel:this.cancelDelete,title:(0,R.formatMessage)({id:"confirmModal.backup.title.delete"}),desc:(0,R.formatMessage)({id:"confirmModal.backup.delete.desc"}),subDesc:(0,R.formatMessage)({id:"confirmModal.delete.strategy.subDesc"}),deleteLoading:b}))}},w=y))||w);t.default=Y},deV3:function(e,t,a){"use strict";var s=a("g09b"),o=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var i=s(a("kLXV"));a("DZo9");var r=s(a("8z0m"));a("+L6B");var l=s(a("2/Rp"));a("/xke");var p,n,u,c=s(a("TeRw")),d=a("MuoO"),m=o(a("q1tI")),h=a("LLXN"),g=s(a("nyIC")),f=s(a("8+Sn")),k=s(a("QDog")),b=f.default.get("token"),v={};b&&(v.Authorization="GRJWT ".concat(b),v.X_REGION_NAME=k.default.getCurrRegionName(),v.X_TEAM_NAME=k.default.getCurrTeamName());var B=(p=(0,d.connect)(e=>{var t=e.user,a=e.global,s=e.application;return{groupDetail:s.groupDetail||{},currUser:t.currentUser,groups:a.groups||[]}}),p((u=class extends m.PureComponent{constructor(e){super(e),this.onChange=(e=>{var t=e.fileList,a=e.file.status;if("done"===a)this.props.onReLoad&&this.props.onReLoad();else if("error"===a){var s=e.file.response;c.default.warning({message:s.msg_show})}t[0]&&"error"==t[0].status?this.setState({fileList:[]}):this.setState({fileList:t})}),this.handleProgress=((e,t)=>{var a=this.state.fileList;a=a.map(a=>{return a.uid===t.uid&&(a.percent=e.percent),a}),this.setState({fileList:a})}),this.onRemove=(e=>{return c.default.info({message:(0,h.formatMessage)({id:"status.app.backups.imported"}),duration:"2"}),!1}),this.onData=(e=>{console.log("---\x3e".concat(JSON.stringify(e)))}),this.state={fileList:[]}}render(){var e=this.props.groupId,t=k.default.getCurrTeamName(),a="".concat(g.default.baseUrl,"/console/teams/").concat(t,"/groupapp/").concat(e,"/backup/import"),s=this.state.fileList;return m.default.createElement(i.default,{visible:!0,onCancel:this.props.onCancel,title:(0,h.formatMessage)({id:"appBackups.table.pages.importBackup.title"}),footer:[m.default.createElement(l.default,{key:"back",onClick:this.props.onCancel},(0,h.formatMessage)({id:"button.close"}))]},m.default.createElement(r.default,{action:a,fileList:s,onChange:this.onChange,headers:v,onRemove:this.onRemove,onProgress:this.handleProgress,data:this.onData},s.length>0?null:m.default.createElement(l.default,null,(0,h.formatMessage)({id:"appBackups.importBackup.select.file"}))))}},n=u))||n);t.default=B}}]);