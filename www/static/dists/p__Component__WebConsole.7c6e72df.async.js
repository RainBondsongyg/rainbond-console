(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[26],{"51PC":function(e,t,s){"use strict";var n=s("/POA"),a=s("R9As"),r=s("0fl0"),o=s("QIth");Object.defineProperty(t,"__esModule",{value:!0});var i=s("q1tI"),c=s("TSYQ");class l extends i.Component{constructor(e,t){super(e,t),this.onInput=(e=>{this.props.onInput&&this.props.onInput(e)}),this.state={isFocused:!1}}componentDidMount(){this.xterm=new n.Terminal(this.props.options);var e=new a.FitAddon;this.xterm.loadAddon(e),this.xterm.loadAddon(new r.SearchAddon),this.xterm.loadAddon(new o.WebLinksAddon),this.xterm.setOption("fontSize",16),this.xterm.setOption("fontFamily",'"DejaVu Sans Mono", "Everson Mono", FreeMono, Menlo, Terminal, monospace, "Apple Symbols"'),this.xterm.open(this.refs.container),e.fit(),this.props.onContextMenu&&this.xterm.element.addEventListener("contextmenu",this.onContextMenu.bind(this)),this.props.onInput&&this.xterm.onData(this.onInput),this.props.value&&this.xterm.write(this.props.value)}componentWillUnmount(){this.xterm&&(this.xterm.dispose(),this.xterm=null)}getTerminal(){return this.xterm}write(e){this.xterm.write(e)}writeln(e){this.xterm.writeln(e)}focus(){this.xterm&&this.xterm.focus()}resize(e,t){this.xterm.resize(Math.round(e),Math.round(t))}setOption(e,t){this.xterm.setOption(e,t)}refresh(){this.xterm.refresh(0,this.xterm.rows-1)}onContextMenu(e){this.props.onContextMenu&&this.props.onContextMenu(e)}render(){var e=c("ReactXTerm",this.state.isFocused?"ReactXTerm--focused":null,this.props.className);return i.createElement("div",{ref:"container",className:e})}}t.default=l,t.XTerm=l},GQsv:function(e,t,s){"use strict";var n=s("tAuX"),a=s("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(s("gjeX")),o=n(s("q1tI"));s("q7KB");var i=s("pyUi"),c=s("HPVU"),l=s("uCTZ"),d=a(s("51PC"));class h extends o.PureComponent{constructor(e){super(e),this.EstablishConnection=(()=>{return new Promise(()=>{var e=this.props,t=e.tenantID,s=e.serviceID,n=e.podName,a=e.containerName,o=e.WebsocketURL,d=e.updateTitle,h=e.namespace;if(!this.inputRef.current)return null;var m=this.inputRef.current.getTerminal(),u=o.replace("/event_log","/docker_console"),p=new i.ConnectionFactory(u,c.protocols),f="",v=(0,r.default)("".concat(t,"_").concat(s,"_").concat(n)),g={T_id:t,S_id:s,C_id:n,containerName:a,Md5:v,namespace:h},_=new l.Xterm(m);_.removeMessage=this.clearMessage,_.setWindowTitle=(e=>{d&&d(e)});var b=new c.WebTTY(_,p,g,f),w=b.open();this.closer=w,this.clearMessage()})}),this.clearMessage=(()=>{this.setState({message:""})}),this.inputRef=o.default.createRef(),this.state={message:"\u6b63\u5728\u8fde\u63a5"}}componentDidMount(){this.EstablishConnection()}componentWillUnmount(){null!=this.closer&&this.closer(),this.inputRef.current&&this.inputRef.current.componentWillUnmount()}render(){var e=this.state.message;return o.default.createElement("div",{style:{height:"calc(100vh - 104px)",backgroundColor:"rgb(0, 0, 0)"}},o.default.createElement(d.default,{ref:this.inputRef}),e&&o.default.createElement("div",{className:"xterm-overlay"},e))}}var m=h;t.default=m},HPVU:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTTY=t.msgSetReconnect=t.msgSetPreferences=t.msgSetWindowTitle=t.msgPong=t.msgOutput=t.msgUnknownOutput=t.msgResizeTerminal=t.msgPing=t.msgInput=t.msgInputUnknown=t.protocols=void 0;var n=["webtty"];t.protocols=n;var a="0";t.msgInputUnknown=a;var r="1";t.msgInput=r;var o="2";t.msgPing=o;var i="3";t.msgResizeTerminal=i;var c="0";t.msgUnknownOutput=c;var l="1";t.msgOutput=l;var d="2";t.msgPong=d;var h="3";t.msgSetWindowTitle=h;var m="4";t.msgSetPreferences=m;var u="5";t.msgSetReconnect=u;class p{constructor(e,t,s,n){this.term=e,this.connectionFactory=t,this.args=s,this.authToken=n,this.reconnect=-1}open(){var e,t,s=this.connectionFactory.create(),n=()=>{s.onOpen(()=>{var t=this.term.info();s.send(JSON.stringify(this.args));var n=(e,t)=>{s.send(i+JSON.stringify({columns:e,rows:t}))};this.term.onResize(n),n(t.columns,t.rows),this.term.onInput(e=>{for(var t=0;t<e.length/1e3;t+=1){var n=e.substr(1e3*t,1e3);s.send(r+n)}}),e=window.setInterval(()=>{s.send(o)},3e4)}),s.onReceive(e=>{var t=e.slice(1);switch(e[0]){case l:this.term.output(atob(t));break;case d:break;case h:this.term.setWindowTitle(t);break;case m:var s=JSON.parse(t);this.term.setPreferences(s);break;case u:var n=JSON.parse(t);this.reconnect=n;break;default:break}}),s.onClose(()=>{clearInterval(e),this.term.deactivate(),this.term.showMessage("Connection Closed",0),this.reconnect>0&&(t=window.setTimeout(()=>{s=this.connectionFactory.create(),this.term.reset(),n()},1e3*this.reconnect))}),s.open()};return n(),()=>{clearTimeout(t),this.reconnect=-1,s.close()}}}t.WebTTY=p},VMuN:function(e,t,s){e.exports={nameID:"nameID___1ITqR",icon:"icon___gohI4",iconm:"iconm___1RD7_",box:"box___1Uhcz",consoleBody:"consoleBody___2DZ7p",menus:"menus___3r8E8",col:"col___3QrBB",header:"header___1eJBw",sync:"sync___3m3Ko",control:"control___mb5Yb",tabs:"tabs___3XRXq",consoleBox:"consoleBox___2Oxez",titleTab:"titleTab___Knaf3",closeTab:"closeTab___3eM_g"}},pyUi:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionFactory=t.Connection=void 0;class n{constructor(e,t){this.bare=new WebSocket(e,t)}open(){}close(){this.bare.close()}send(e){this.bare.readyState!==WebSocket.CLOSED&&this.bare.readyState!==WebSocket.CLOSING&&this.bare.send(e)}isOpen(){return this.bare.readyState===WebSocket.CONNECTING||this.bare.readyState===WebSocket.OPEN}onOpen(e){this.bare.onopen=(()=>{e()})}onReceive(e){this.bare.onmessage=(t=>{e(t.data)})}onClose(e){this.bare.onclose=(()=>{e()})}}t.Connection=n;class a{constructor(e,t){this.url=e,this.protocols=t}create(){return new n(this.url,this.protocols)}}t.ConnectionFactory=a},uCTZ:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Xterm=void 0;var n=s("rSVU");class a{constructor(e){this.term=e,this.messageTimeout=2e3,this.resizeListener=(()=>{this.term.scrollToBottom(),this.showMessage("".concat(String(this.term.cols),"x").concat(String(this.term.rows)),this.messageTimeout)}),this.resizeListener(),window.addEventListener("resize",()=>{this.resizeListener()}),this.decoder=new n.lib.UTF8Decoder}info(){return{columns:this.term.cols,rows:this.term.rows}}output(e){this.term.write(this.decoder.decode(e))}showMessage(e,t){}removeMessage(){}setWindowTitle(e){}onInput(e){this.term.onData((t,s)=>{e(t)})}onResize(e){this.term.onResize(t=>{e(t.cols,t.rows)})}setPreferences(e){}deactivate(){this.term&&this.term.blur()}reset(){this.removeMessage(),this.term.reset()}close(){window.removeEventListener("resize",this.resizeListener),this.term.dispose()}}t.Xterm=a},uj6I:function(e,t,s){"use strict";var n=s("g09b"),a=s("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,s("14J3");var r=n(s("BMrR"));s("jCWc");var o=n(s("kPKH"));s("T2oS");var i=n(s("W9HT"));s("Znn+");var c=n(s("ZTPi"));s("ozfa");var l,d,h,m=n(s("MJZm")),u=s("MuoO"),p=a(s("q1tI")),f=s("LLXN"),v=n(s("QDog")),g=n(s("VMuN")),_=n(s("GQsv")),b=m.default.TreeNode,w=c.default.TabPane,y=(l=(0,u.connect)(e=>{var t=e.user,s=e.appControl,n=e.global,a=e.teamControl,r=e.enterprise;return{currUser:t.currentUser,appDetail:s.appDetail,pods:s.pods,groups:n.groups,build_upgrade:s.build_upgrade,currentTeam:a.currentTeam,currentRegionName:a.currentRegionName,currentEnterprise:r.currentEnterprise}},null,null,{withRef:!0}),l((h=class extends p.PureComponent{constructor(e){super(e),this.onEdit=((e,t)=>{this[t](e)}),this.onChange=(e=>{this.setState({activeKey:e})}),this.onSelect=(e=>{if(e.length>0){var t=e[0];if(t.indexOf(".")>-1){var s=t.split("."),n=s[0],a=s[1];this.setState({podName:n,containerName:a}),this.openConsole(n,a)}}else{var r=this.state,o=r.podName,i=r.containerName;o&&i&&this.openConsole(o,i)}}),this.openConsole=((e,t)=>{var s=Math.random().toString(36).slice(-8),n={podName:e,containerName:t,title:t,key:s},a=this.state.tabs;a.push(n),this.setState({tabs:a,activeKey:s})}),this.updateTitle=((e,t)=>{var s=this.state.tabs,n=[];s.forEach(s=>{s.key==e&&(s.title=t),n.push(s)}),this.setState({tabs:n})}),this.fetchPods=(e=>{this.setState({loading:!0});var t=this.state.appDetail.service.service_id;this.props.dispatch({type:"appControl/fetchPods",payload:{team_name:v.default.getCurrTeamName(),app_alias:v.default.getComponentID()},callback:s=>{var n=[];if(s.list&&s.list.new_pods&&(n=s.list.new_pods),s.list&&s.list.old_pods&&(n=n.concat(s.list.old_pods)),this.clearLoading(),e&&n&&n.length>0&&n[0].container&&n[0].container.length>0){var a=n[0].container.filter(e=>e.container_name.includes(t)),r=a&&a.length>0?a[0].container_name:n[0].container[0].container_name,o=Math.random().toString(36).slice(-8),i={podName:n[0].pod_name,containerName:r,title:r,key:o};this.setState({tabs:[i],activeKey:o,pods:n})}else this.setState({pods:n})}})}),this.loadDetail=(()=>{this.props.dispatch({type:"appControl/fetchDetail",payload:{team_name:v.default.getCurrTeamName(),app_alias:v.default.getComponentID()},callback:e=>{this.setState({appDetail:e},()=>{this.fetchPods(!0)})}})}),this.controllLeft=(()=>{var e=this.state.leftWidth;0===e?this.setState({leftWidth:5}):this.setState({leftWidth:0})}),this.clearLoading=(()=>{this.setState({loading:!1})}),this.remove=(e=>{var t=this.state.tabs,s=t.filter(t=>t.key!==e),n=s.length>0?s[0].key:"";this.setState({tabs:s,activeKey:n})}),this.leftRender=(e=>{var t=this.state,s=t.pods,n=t.loading,a=[];return s&&s.length>0&&s[0].container&&s[0].container.length>0&&(a=[s[0].container[0].container_name]),p.default.createElement("div",{className:g.default.menus},p.default.createElement("div",{className:g.default.header},p.default.createElement("span",null,(0,f.formatMessage)({id:"componentOverview.header.list"})),p.default.createElement("span",{className:g.default.sync,onClick:()=>{this.fetchPods(!1)}},p.default.createElement("svg",{t:"1588475055820",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3297",width:"20",height:"20"},p.default.createElement("path",{d:"M134.4 518.4c19.2 0 38.4-19.2 38.4-38.4 0-185.6 153.6-339.2 339.2-339.2 115.2 0 217.6 57.6 281.6 147.2h-44.8c-19.2 0-38.4 19.2-38.4 38.4s19.2 38.4 38.4 38.4h140.8c19.2 0 38.4-19.2 38.4-38.4V192c0-19.2-19.2-38.4-38.4-38.4s-38.4 19.2-38.4 38.4v44.8C768 128 646.4 64 512 64 281.6 64 96 249.6 96 480c0 19.2 19.2 38.4 38.4 38.4z m755.2-76.8c-19.2 0-38.4 19.2-38.4 38.4 0 185.6-153.6 339.2-339.2 339.2-102.4 0-204.8-51.2-262.4-128h38.4c19.2 0 38.4-19.2 38.4-38.4s-19.2-38.4-38.4-38.4H147.2c-19.2 0-38.4 19.2-38.4 38.4v140.8c0 19.2 19.2 38.4 38.4 38.4s38.4-19.2 38.4-38.4v-57.6C262.4 838.4 384 896 512 896c230.4 0 416-185.6 416-416 0-19.2-19.2-38.4-38.4-38.4z","p-id":"3298",fill:"#ffffff"})))),p.default.createElement(i.default,{spinning:n,tip:"Loading..."},s&&s.length>0&&p.default.createElement(m.default,{defaultExpandAll:!0,onSelect:this.onSelect,defaultSelectedKeys:a},s.map(t=>{var s=t.pod_name,n=s;return n.includes("deployment")&&(n=n.slice(n.indexOf("-")+1)),p.default.createElement(b,{title:(0,f.formatMessage)({id:"componentOverview.header.example"},{title:n}),key:s},t.container.map(t=>{var n=t.container_name,a="".concat((0,f.formatMessage)({id:"componentOverview.header.container"},{name:n}));return n.includes(e.k8s_component_name)&&!n.includes("default-tcpmesh")?a="".concat((0,f.formatMessage)({id:"componentOverview.header.Component_container"})):n.includes("plugin")?a="".concat((0,f.formatMessage)({id:"componentOverview.header.Plug_container"})):n.includes("default-tcpmesh")&&(a="".concat((0,f.formatMessage)({id:"componentOverview.header.mesh"}))),p.default.createElement(b,{isLeaf:!0,title:a,key:"".concat(s,".").concat(n)})}))}))))}),this.tabContent=((e,t,s)=>{var n=this.state.appDetail;return p.default.createElement(_.default,{key:e+t,tenantID:n.service.tenant_id,serviceID:n.service.service_id,WebsocketURL:n.event_websocket_url,updateTitle:e=>this.updateTitle(s,e),podName:e,containerName:t,namespace:n.service.namespace})}),this.state={loading:!1,pods:[],tabs:[],leftWidth:5,appDetail:{},activeKey:""}}componentDidMount(){this.loadDetail()}render(){var e=this.state,t=e.leftWidth,s=e.tabs,n=e.appDetail,a=e.activeKey,i=n&&n.service;return p.default.createElement(r.default,{className:g.default.box},p.default.createElement(o.default,{className:g.default.col,style:{background:"#2f2a2a"},span:t},i&&this.leftRender(i)),p.default.createElement(o.default,{className:g.default.col,span:24-t},p.default.createElement("span",{onClick:this.controllLeft,className:g.default.control},t>0?p.default.createElement("svg",{t:"1588476023049",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4836",width:"200",height:"200"},p.default.createElement("path",{d:"M68.608 517.632l207.36 159.744V357.888zM939.52 227.328H83.968c-8.704 0-15.872-7.168-15.872-15.872V144.384c0-8.704 7.168-15.872 15.872-15.872h855.552c8.704 0 15.872 7.168 15.872 15.872v67.072c0 8.704-7.168 15.872-15.872 15.872M939.52 906.24H83.968c-8.704 0-15.872-7.168-15.872-15.872v-67.072c0-8.704 7.168-15.872 15.872-15.872h855.552c8.704 0 15.872 7.168 15.872 15.872v67.072c0 8.704-7.168 15.872-15.872 15.872M939.52 453.632H429.056c-8.704 0-15.872-7.168-15.872-15.872V370.688c0-8.704 7.168-15.872 15.872-15.872h510.464c8.704 0 15.872 7.168 15.872 15.872v67.072c0 8.704-7.168 15.872-15.872 15.872M939.52 679.936H429.056c-8.704 0-15.872-7.168-15.872-15.872v-67.072c0-8.704 7.168-15.872 15.872-15.872h510.464c8.704 0 15.872 7.168 15.872 15.872v67.072c0 8.704-7.168 15.872-15.872 15.872",fill:"#ffffff","p-id":"4837"})):p.default.createElement("svg",{t:"1588476580322",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5067",width:"200",height:"200"},p.default.createElement("path",{d:"M112.80000001 356L623.2 356c24.8 0 44.8 21.6 44.8 48s-20 48-44.8 48l-510.4 0c-24.8 0-44.8-21.6-44.8-48s20-48 44.80000001-48z m-1e-8 224L623.2 580c24.8 0 44.8 21.6 44.8 48s-20 48-44.8 48l-510.4-1e-8c-24.8 0-44.8-21.6-44.8-47.99999999s20-48 44.8-48zM116 796L900 796c26.4 0 48 21.6 48 48s-21.6 48-48 48l-784 0c-26.4 0-48-21.6-48-48s21.6-48 48-48zM724 356L948 516l-224 160 0-320zM900 236l-784 0c-26.4 0-48-21.6-48-48s21.6-48 48-48L900 140c26.4 0 48 21.6 48 48s-21.6 48-48 48z","p-id":"5068",fill:"#ffffff"}))),p.default.createElement("div",{className:g.default.tabs},s.length>0&&i&&p.default.createElement(c.default,{defaultActiveKey:"".concat(s[s.length-1].key),onChange:this.onChange,activeKey:a,type:"editable-card",onEdit:this.onEdit,hideAdd:!0},s.map(e=>{var t=e.title,s=e.podName,n=e.key,a=e.containerName;return p.default.createElement(w,{tab:p.default.createElement("div",null,p.default.createElement("span",{className:g.default.titleTab},t||s)),className:g.default.consoleBox,key:n},this.tabContent(s,a,n))})))))}},d=h))||d);t.default=y}}]);