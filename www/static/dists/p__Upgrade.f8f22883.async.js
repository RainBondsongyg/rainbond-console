(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[73],{NkCp:function(e,t,a){"use strict";var r=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=r(a("kLXV"));a("IzEo");var n=r(a("bx4M"));a("+L6B");var i=r(a("2/Rp"));a("y8nQ");var o,d,c,p,u=r(a("Vl3Y")),h=r(a("e6Ls")),m=a("MuoO"),g=l(a("q1tI")),f=a("xpXo"),_=r(a("4W9V")),v=r(a("VZuE")),k=(o=(0,m.connect)(),d=u.default.create(),o(c=d((p=class extends g.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,r=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&r&&r(t)})}),this.handleLoading=(e=>{this.setState({recordLoading:e})}),this.fetchRollsBackRecordDetails=(()=>{var e=this.props,t=e.team_name,a=e.group_id,r=e.info;this.handleLoading(!0),(0,f.getRollsBackRecordDetails)({team_name:t,group_id:a,record_id:r.ID,noModels:!0}).then(e=>{var t=e.bean||{};this.setState({list:t.service_record||[],textState:t.status,recordLoading:!1},()=>{4===t.status&&setTimeout(()=>{this.fetchRollsBackRecordDetails()},3e3)})}).catch(e=>{(0,_.default)(e)})}),this.handleRetry=(()=>{var e=this.props,t=e.form,a=e.dispatch,r=e.team_name,l=e.group_id,s=e.info,n=this.state.upgradeLoading;t.validateFields(e=>{e||n||this.setState({upgradeLoading:!0},()=>{a({type:"global/fetchAppRedeploy",payload:{team_name:r,group_id:l,record_id:s.ID},callback:e=>{e&&200===e.status_code&&this.setState({upgradeLoading:!1},()=>{this.fetchRollsBackRecordDetails()})},handleError:e=>{(0,_.default)(e),this.fetchRollsBackRecordDetails()}})})})}),this.state={list:[],textState:"",upgradeLoading:!1,recordLoading:!1}}componentDidMount(){this.fetchRollsBackRecordDetails()}render(){var e=this.props,t=e.onCancel,a=e.loading,r=void 0!==a&&a,l=this.state,o=l.recordLoading,d=l.list,c=l.textState,p=l.upgradeLoading,u={width:d&&1===d.length?"100%":"50%",textAlign:"center"},m=[7,10].includes(c);return g.default.createElement(s.default,{visible:!0,title:"\u56de\u6eda\u8be6\u60c5",width:1e3,confirmLoading:r,className:h.default.TelescopicModal,onCancel:t,footer:[g.default.createElement(i.default,{style:{marginTop:"20px"},onClick:t},"\u5173\u95ed")]},g.default.createElement(n.default,{title:"\u7ec4\u4ef6\u5217\u8868",loading:o,extra:g.default.createElement(i.default,{type:"primary",loading:p,onClick:m?this.handleRetry:t},m?"\u91cd\u8bd5":v.default.getStatusCNS(c))},d&&d.length>0&&d.map(e=>{var t=e.ID,a=e.status,r=e.service_cname;return g.default.createElement(n.default.Grid,{key:t,style:u},r," \u72b6\u6001\uff1a",g.default.createElement("span",{style:{color:v.default.getStatusColor(a)}},v.default.getStatusCNS(a)))})))}},c=p))||c)||c);t.default=k},T40H:function(e,t,a){"use strict";var r=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("+L6B");var s=r(a("2/Rp"));a("2qtc");var n=r(a("kLXV")),i=r(a("jehZ"));a("g9YV");var o=r(a("wCAj"));a("Mwp2");var d=r(a("VXEj"));a("Telt");var c=r(a("Tckk"));a("T2oS");var p=r(a("W9HT"));a("+BJd");var u=r(a("mr32"));a("5Dmo");var h=r(a("3S7+"));a("y8nQ");var m=r(a("Vl3Y"));a("Znn+");var g,f,_,v,k=r(a("ZTPi")),b=r(a("x9lC")),L=a("MuoO"),E=a("7DNP"),R=r(a("wd/R")),y=l(a("q1tI")),C=a("LLXN"),w=r(a("iPMB")),D=r(a("XZXw")),M=a("xpXo"),S=a("vSx2"),I=r(a("4W9V")),x=r(a("QDog")),U=r(a("hMqj")),A=r(a("Utb7")),N=r(a("NkCp")),z=r(a("ZBNA")),T=r(a("VZuE")),P=k.default.TabPane,V=(g=m.default.create(),f=(0,L.connect)(e=>{var t=e.user,a=e.global,r=e.application,l=e.teamControl,s=e.enterprise;return{groupDetail:r.groupDetail||{},currUser:t.pageUser,groups:a.groups||[],currentTeam:l.currentTeam,currentRegionName:l.currentRegionName,currentEnterprise:s.currentEnterprise,currentTeamPermissionsInfo:l.currentTeamPermissionsInfo}}),g(_=f((v=class extends y.PureComponent{constructor(e){super(e),this.onUpgrade=(e=>{var t=this.getParameter(),a=t.team_name,r=t.group_id;(0,M.getAppModelLastRecord)({appID:r,team_name:a,upgrade_group_id:e.upgrade_group_id}).then(t=>{var a=t.bean&&t.bean.status;if(a){if([6,10].includes(a))return void this.setState({isDeploymentFailure:10===a,isPartiallyCompleted:6===a,showLastUpgradeRecord:!0,upgradeItem:e});if([3,8].includes(a))return void this.createNewRecord(e);this.openInfoPage(t.bean)}else this.createNewRecord(e)})}),this.getApplication=(()=>{var e=this.props.dispatch;e({type:"global/application",payload:{team_name:x.default.getCurrTeamName(),group_id:this.getGroupId()},callback:e=>{e&&200===e.status_code&&this.setState({dataList:e.list||[]}),this.handleCancelLoading()}})}),this.getParameter=(()=>{var e=this.props.match.params,t=e.teamName,a=e.regionName,r=e.appID;return{team_name:t,region_name:a,group_id:r}}),this.getGroupId=(()=>{var e=this.props.match.params;return e.appID}),this.getUpgradeRecordsList=(()=>{var e=this.state,t=e.page,a=e.pageSize,r=this.getParameter(),l=r.team_name,s=r.group_id;this.props.dispatch({type:"global/CloudAppUpdateRecordsList",payload:{team_name:l,group_id:s,page:t,pageSize:a,status__gt:1},callback:e=>{e&&200===e.status_code&&this.setState({list:e.list||[],total:e.bean&&e.bean.total}),this.handleCancelLoading()}})}),this.getVersionChangeShow=(e=>{return e.market_name?y.default.createElement("div",null,"\u901a\u8fc7\u5e94\u7528\u5546\u5e97\uff08",e.market_name,"\uff09\u4ece\u7248\u672c",y.default.createElement("span",{className:A.default.versions},e.old_version),"\u5347\u7ea7\u5230",y.default.createElement("span",{className:A.default.versions},e.version)):y.default.createElement("div",null,"\u4ece\u7248\u672c",y.default.createElement("span",{className:A.default.versions},e.old_version),"\u5347\u7ea7\u5230",y.default.createElement("span",{className:A.default.versions},e.version))}),this.fetchAppLastUpgradeRecord=(()=>{var e=this.getParameter(),t=e.team_name,a=e.group_id;(0,M.getAppModelLastRecord)({team_name:t,appID:a,noModels:!0}).then(e=>{var t=e.bean;t&&"{}"!==JSON.stringify(t)&&this.setState({lastRecord:t,showLastUpgradeRecord:[2].includes(t.status)})}).catch(e=>{(0,I.default)(e)})}),this.fetchAppLastRollbackRecord=(e=>{var t=this.getParameter(),a=t.team_name,r=t.group_id;(0,M.getAppModelLastRecord)({team_name:a,appID:r,record_type:"rollback",noModels:!0}).then(t=>{var a=t.bean;if(a&&"{}"!==JSON.stringify(a)){var r=[4].includes(a.status);r?this.setState({lastRecord:a,showLastRollbackRecord:r}):this.onUpgrade(e)}else this.onUpgrade(e)}).catch(e=>{(0,I.default)(e)})}),this.getUpgradeRecordsHelmList=(()=>{var e=this.state,t=e.page,a=e.pageSize;this.props.dispatch({type:"global/fetchUpgradeRecordsHelmList",payload:{team_name:x.default.getCurrTeamName(),group_id:this.getGroupId(),page:t,pageSize:a},callback:e=>{this.handleLoading(),e&&200===e.status_code&&this.setState({list:e.list||[]}),this.handleCancelLoading()}})}),this.handleLoading=(()=>{this.setState({loadingList:!1,recordLoading:!1,upgradeLoading:!1})}),this.createNewRecord=(e=>{var t=this.getParameter(),a=t.team_name,r=t.group_id;(0,M.postUpgradeRecord)({team_name:a,appID:r,upgrade_group_id:e.upgrade_group_id,noModels:!0}).then(e=>{this.openInfoPage(e.bean)}).catch(e=>{(0,I.default)(e)})}),this.fetchAppDetail=(()=>{var e=this.props.dispatch;this.setState({loadingDetail:!0}),e({type:"application/fetchGroupDetail",payload:this.getParameter(),callback:e=>{e&&200===e.status_code&&this.setState({appDetail:e.bean,loadingDetail:!1},()=>{e.bean&&e.bean.app_type&&"helm"===e.bean.app_type?this.handleTabs("2"):this.getApplication()})},handleError:t=>{t&&404===t.code&&e(E.routerRedux.push("/team/".concat(x.default.getCurrTeamName(),"/region/").concat(x.default.getCurrRegionName(),"/apps")))}})}),this.openInfoPage=(e=>{var t=this.getParameter(),a=t.team_name,r=t.group_id,l=this.props.dispatch;l(E.routerRedux.push("/team/".concat(a,"/region/").concat(x.default.getCurrRegionName(),"/apps/").concat(r,"/upgrade/").concat(e.upgrade_group_id,"/record/").concat(e.ID,"?app_id=").concat(e.group_key)))}),this.showMarketAppDetail=(e=>{this.setState({showApp:e,showMarketAppDetail:!0})}),this.showRollback=(e=>{this.setState({showRollbackConfirm:e,rollbackRecord:e})}),this.showRollbackList=(e=>{this.setState({rollbackRecords:e})}),this.showRollbackDetails=(e=>{this.setState({rollbackRecordDetails:e})}),this.hideMarketAppDetail=(()=>{this.setState({showApp:{},showMarketAppDetail:!1})}),this.handleTabs=(e=>{var t=this.state.appDetail;this.setState({upgradeLoading:!0,recordLoading:!0,activeKey:e},()=>{"helm"===t.app_type?this.getUpgradeRecordsHelmList():"2"===e?this.getUpgradeRecordsList():this.getApplication()})}),this.handleTableChange=((e,t)=>{this.setState({page:e,pageSize:t},()=>{this.getUpgradeRecordsList()})}),this.rollbackUpgrade=(()=>{this.handleBackUpgradeLoading(!0);var e=this.state.rollbackRecord,t=this.getParameter(),a=t.team_name,r=t.group_id;(0,M.rollbackUpgrade)({team_name:a,appID:r,record_id:e.ID}).then(e=>{this.handleBackUpgradeLoading(!1),this.showRollback(!1),this.showRollbackDetails(e&&e.bean)}).catch(e=>{this.handleBackUpgradeLoading(!1),(0,I.default)(e)})}),this.handleBackUpgradeLoading=(e=>{this.setState({backUpgradeLoading:e})}),this.showComponentVersion=(e=>{this.setState({isComponent:e})}),this.handleCancelComponent=(()=>{this.setState({isComponent:!1})}),this.handleCancelLoading=(()=>{this.setState({loadingList:!1,upgradeLoading:!1,recordLoading:!1})}),this.state={loadingDetail:!0,loadingList:!0,isDeploymentFailure:!1,isPartiallyCompleted:!1,upgradeLoading:!0,recordLoading:!0,isComponent:!1,showApp:{},showMarketAppDetail:!1,list:[],activeKey:"1",page:1,pageSize:10,total:0,dataList:[],appDetail:{},backUpgradeLoading:!1,showLastUpgradeRecord:!1,showLastRollbackRecord:!1,rollbackRecords:!1,rollbackRecordDetails:!1}}componentWillMount(){var e=this.props,t=e.currentTeamPermissionsInfo,a=e.dispatch,r=U.default.queryAppInfo(t,"upgrade");r||x.default.withoutPermission(a)}componentDidMount(){this.fetchAppDetail(),this.getApplication(),this.fetchAppLastUpgradeRecord()}render(){var e=this.props,t=e.currentEnterprise,r=e.currentTeam,l=e.currentRegionName,m=this.state,g=m.loadingList,f=m.recordLoading,_=m.upgradeLoading,v=m.list,L=m.showMarketAppDetail,E=m.showApp,M=m.activeKey,I=m.page,x=m.total,U=m.pageSize,V=m.dataList,B=m.appDetail,O=m.isComponent,X=m.loadingDetail,Y=m.lastRecord,q=m.showLastUpgradeRecord,F=m.showLastRollbackRecord,H=m.upgradeItem,Z=m.isDeploymentFailure,j=m.isPartiallyCompleted,G=m.showRollbackConfirm,K=m.rollbackRecords,J=m.rollbackRecordDetails,Q=m.backUpgradeLoading,W={onChange:this.handleTableChange,pageSize:U,total:x,page:I},$=e=>{var t=e.data,a=t.upgrade_versions,r=t.current_version;return y.default.createElement("div",{className:A.default.listContent},y.default.createElement("div",{className:A.default.listContentItem},y.default.createElement(h.default,{title:(0,C.formatMessage)({id:"appUpgrade.current_version.tooltip"})},y.default.createElement("span",null,(0,C.formatMessage)({id:"appUpgrade.current_version"}))),y.default.createElement("p",null,y.default.createElement(u.default,{style:{height:"17px",lineHeight:"16px",marginBottom:"3px"},color:"green",size:"small"},r))),y.default.createElement("div",{className:A.default.listContentItem},y.default.createElement(h.default,{title:(0,C.formatMessage)({id:"appUpgrade.Upgradable_version.tooltip"})},y.default.createElement("span",null,(0,C.formatMessage)({id:"appUpgrade.Upgradable_version"}))),y.default.createElement("p",null,a&&a.length>0?a.map(e=>{return y.default.createElement(u.default,{style:{height:"17px",lineHeight:"16px",marginBottom:"3px"},color:"green",size:"small",key:e},e)}):"\u6682\u65e0")))},ee=[{title:(0,C.formatMessage)({id:"appUpgrade.table.createTime"}),dataIndex:"create_time",key:"1",width:"20%",render:e=>y.default.createElement("span",null,(0,R.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:(0,C.formatMessage)({id:"appUpgrade.table.app"}),dataIndex:"group_name",key:"2",width:"20%",render:e=>y.default.createElement("span",null,e)},{title:(0,C.formatMessage)({id:"appUpgrade.table.versions"}),dataIndex:"version",key:"3",width:"30%",render:(e,t)=>this.getVersionChangeShow(t)},{title:(0,C.formatMessage)({id:"appUpgrade.table.status"}),dataIndex:"status",key:"4",width:"15%",render:e=>y.default.createElement("span",null,T.default.getStatusText(e))},{title:(0,C.formatMessage)({id:"appUpgrade.table.operate"}),dataIndex:"tenant_id",key:"5",width:"15%",render:(e,t)=>t.can_rollback&&y.default.createElement("div",null,y.default.createElement("a",{onClick:e=>{e.preventDefault(),this.showRollback(t)}},(0,C.formatMessage)({id:"appUpgrade.table.operate.roll_back"})),y.default.createElement("a",{onClick:e=>{e.preventDefault(),this.showRollbackList(t)}},(0,C.formatMessage)({id:"appUpgrade.table.operate.roll_back_record"})))}],te=[{title:(0,C.formatMessage)({id:"appUpgrade.table.createTime"}),dataIndex:"updated",key:"1",render:e=>y.default.createElement("span",null,(0,R.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:(0,C.formatMessage)({id:"appUpgrade.table.chart"}),dataIndex:"chart",key:"2",render:e=>y.default.createElement("span",null,e)},{title:(0,C.formatMessage)({id:"appUpgrade.table.versions"}),dataIndex:"app_version",key:"3",render:e=>y.default.createElement("span",null,e)},{title:(0,C.formatMessage)({id:"appUpgrade.table.status"}),dataIndex:"status",key:"4",render:e=>y.default.createElement("span",null,T.default.getHelmStatus(e))}],ae=[];ae=(0,S.createApp)((0,S.createTeam)((0,S.createEnterprise)(ae,t),r,l),r,l,{appName:B.group_name,appID:B.group_id});var re=B&&B.app_type&&"helm"===B.app_type;return y.default.createElement(D.default,{breadcrumbList:ae,loading:X,title:(0,C.formatMessage)({id:"appUpgrade.title"}),content:(0,C.formatMessage)({id:"appUpgrade.desc"}),extraContent:null},y.default.createElement("div",null,X?y.default.createElement(p.default,null):y.default.createElement(k.default,{activeKey:M,onChange:this.handleTabs,className:A.default.tabss},!re&&y.default.createElement(P,{tab:(0,C.formatMessage)({id:"appUpgrade.tabs.list"}),key:"1"},y.default.createElement("div",{className:A.default.cardList},y.default.createElement(d.default,{rowKey:"id",size:"large",loading:g,dataSource:[...V],renderItem:e=>y.default.createElement(d.default.Item,{actions:[y.default.createElement("a",{onClick:t=>{t.preventDefault(),this.fetchAppLastRollbackRecord(e)}},(0,C.formatMessage)({id:"appUpgrade.btn.upgrade"})),y.default.createElement("a",{onClick:()=>{this.showComponentVersion(e)}},(0,C.formatMessage)({id:"appUpgrade.btn.addon"}))]},y.default.createElement(d.default.Item.Meta,{avatar:y.default.createElement(c.default,{src:e.pic||a("Vkwn"),shape:"square",size:"large"}),title:y.default.createElement("a",{onClick:()=>{this.showMarketAppDetail(e)}},e.group_name),description:e.describe}),y.default.createElement($,{data:e}))}))),y.default.createElement(P,{tab:(0,C.formatMessage)({id:"appUpgrade.tabs.record"}),key:"2"},y.default.createElement(o.default,{style:{padding:"24px"},loading:f||_,columns:re?te:ee,dataSource:v,pagination:W})))),O&&y.default.createElement(b.default,(0,i.default)({onCancel:this.handleCancelComponent,data:O,ok:this.getApplication},this.getParameter())),L&&y.default.createElement(w.default,{onOk:this.hideMarketAppDetail,onCancel:this.hideMarketAppDetail,app:E}),q&&(Y||H)&&y.default.createElement(n.default,{visible:!0,title:"\u5347\u7ea7\u63d0\u793a",onCancel:()=>{this.setState({showLastUpgradeRecord:!1}),H&&this.createNewRecord(H)},okText:"\u7ee7\u7eed",cancelText:H?"\u65b0\u5347\u7ea7":"\u53d6\u6d88",onOk:()=>{this.openInfoPage(Y||H)}},y.default.createElement("span",null,"\u5e94\u7528\u6a21\u578b",y.default.createElement("span",{style:{color:"4d73b1"}},Y&&Y.group_name||H&&H.group_name),j?"\u4e0a\u6b21\u5347\u7ea7\u4efb\u52a1\u90e8\u5206\u7ec4\u4ef6\u66f4\u65b0\u6210\u529f\uff0c\u662f\u5426\u7ee7\u7eed\u91cd\u8bd5\uff1f":Z?"\u4e0a\u6b21\u5347\u7ea7\u4efb\u52a1\u90e8\u7f72\u5931\u8d25\uff0c\u662f\u5426\u7ee7\u7eed\u91cd\u8bd5\uff1f":"\u5b58\u5728\u672a\u5b8c\u6210\u7684\u5347\u7ea7\u4efb\u52a1\uff0c\u662f\u5426\u7ee7\u7eed\u5b8c\u6210\u4e0a\u6b21\u4efb\u52a1\uff1f")),F&&y.default.createElement(n.default,{visible:!0,title:"\u56de\u6eda\u63d0\u793a",onCancel:()=>{this.setState({showLastRollbackRecord:!1})},footer:[y.default.createElement(s.default,{style:{marginTop:"20px"},onClick:()=>{this.setState({showLastRollbackRecord:!1})}},"\u5173\u95ed")]},y.default.createElement("span",null,"\u5e94\u7528\u6a21\u578b",y.default.createElement("span",{style:{color:"4d73b1"}},Y&&Y.group_name),"\u5b58\u5728\u672a\u5b8c\u6210\u7684\u56de\u6eda\u4efb\u52a1\uff0c\u65e0\u6cd5\u7ee7\u7eed\u5347\u7ea7")),K&&y.default.createElement(z.default,(0,i.default)({},this.getParameter(),{info:K,showRollbackDetails:e=>{this.showRollbackDetails(e)},onCancel:()=>{this.showRollbackList(!1)}})),J&&y.default.createElement(N.default,(0,i.default)({},this.getParameter(),{info:J,onCancel:()=>{this.showRollbackDetails(!1)}})),G&&y.default.createElement(n.default,{visible:!0,confirmLoading:Q,title:"\u56de\u6eda\u786e\u8ba4",onCancel:()=>{this.showRollback(!1)},onOk:()=>{this.rollbackUpgrade()}},y.default.createElement("span",{style:{color:"red"}},"\u786e\u8ba4\u8981\u56de\u6eda\u5417\uff1f"),y.default.createElement("span",{style:{display:"block",marginTop:"16px"}},"\u56de\u6eda\u8fc7\u7a0b\u4e0d\u4f1a\u5220\u9664\u65b0\u589e\u7ec4\u4ef6\u3002")))}},_=v))||_)||_);t.default=V},Utb7:function(e,t,a){e.exports={nameID:"nameID___MNSNW",icon:"icon___2AsL9",iconm:"iconm___qqaow",customBtn:"customBtn___SyQT6",versions:"versions___1Z8uj",cardList:"cardList___Yf-MH",card:"card___3ovxG",item:"item___1Ils1",tabss:"tabss___uEiMM",textzt:"textzt___3pFoJ",zsldis:"zsldis___1GahJ",zslbor:"zslbor___2ZXVM",zsllbor:"zsllbor___3pSS2",extraImg:"extraImg___2CzFB",newButton:"newButton___2YSwX",cardAvatar:"cardAvatar___1xUfe",cardDescription:"cardDescription___2vI9s",pageHeaderContent:"pageHeaderContent___1B8bR",contentLink:"contentLink___1LQb0",zslcheck:"zslcheck___115pt",zslIcon:"zslIcon___3tP6k",zslGroup:"zslGroup___ahs1r",zslMt:"zslMt___3-U0F",active:"active___17Zw6",zslcen:"zslcen___2982Y",zslborl:"zslborl___XdlyT",zslborr:"zslborr___10Zhw",zslh:"zslh___3CELq",listContent:"listContent___3FKvX",listContentItem:"listContentItem___3GH5D",standardList:"standardList___lVj3g",headerInfo:"headerInfo___2zfaG",extraContentSearch:"extraContentSearch___bx9rK",listCard:"listCard___IhqPy",standardListForm:"standardListForm___2itqX",formResult:"formResult___1LmUn"}},ZBNA:function(e,t,a){"use strict";var r=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=r(a("kLXV"));a("g9YV");var n=r(a("wCAj"));a("+L6B");var i=r(a("2/Rp"));a("y8nQ");var o,d,c,p,u=r(a("Vl3Y")),h=r(a("e6Ls")),m=a("MuoO"),g=l(a("q1tI")),f=a("xpXo"),_=r(a("4W9V")),v=r(a("Utb7")),k=r(a("VZuE")),b=(o=(0,m.connect)(),d=u.default.create(),o(c=d((p=class extends g.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,r=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&r&&r(t)})}),this.handleLoading=(e=>{this.setState({recordLoading:e})}),this.fetchRollsBackRecordList=(()=>{var e=this.props,t=e.team_name,a=e.group_id,r=e.info;this.handleLoading(!0),(0,f.getRollsBackRecordList)({team_name:t,group_id:a,record_id:r.ID,noModels:!0}).then(e=>{this.setState({list:e.list||[],recordLoading:!1})}).catch(e=>{(0,_.default)(e)})}),this.state={list:[],recordLoading:!1}}componentDidMount(){this.fetchRollsBackRecordList()}render(){var e=this.props,t=e.onCancel,a=e.loading,r=void 0!==a&&a,l=e.showRollbackDetails,o=this.state,d=o.recordLoading,c=o.list,p=[{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"create_time",key:"1",width:200,render:e=>g.default.createElement("span",null,e)},{title:"\u5e94\u7528\u6a21\u7248\u540d\u79f0",dataIndex:"group_name",key:"2",width:"20%",render:e=>g.default.createElement("span",null,e)},{title:"\u7248\u672c",dataIndex:"version",key:"3",width:"30%",render:(e,t)=>g.default.createElement("div",null,"\u56de\u6eda\u5230",g.default.createElement("span",{className:v.default.versions},t.version))},{title:"\u72b6\u6001",dataIndex:"status",key:"4",width:"15%",render:e=>g.default.createElement("span",null,k.default.getStatusText(e))},{title:"\u8be6\u60c5",dataIndex:"ID",key:"45",render:(e,t)=>g.default.createElement("a",{onClick:()=>{l(t)}},"\u8be6\u60c5")}];return g.default.createElement(s.default,{visible:!0,title:"\u56de\u6eda\u8bb0\u5f55",width:1e3,confirmLoading:r,className:h.default.TelescopicModal,onCancel:t,footer:[g.default.createElement(i.default,{style:{marginTop:"20px"},onClick:t},"\u5173\u95ed")]},g.default.createElement(n.default,{loading:d,columns:p,dataSource:c,pagination:!1}))}},c=p))||c)||c);t.default=b},x9lC:function(e,t,a){"use strict";var r=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=r(a("kLXV"));a("g9YV");var n=r(a("wCAj"));a("+L6B");var i=r(a("2/Rp"));a("5Dmo");var o=r(a("3S7+"));a("/xke");var d=r(a("TeRw"));a("y8nQ");var c=r(a("Vl3Y"));a("OaEy");var p,u,h,m,g=r(a("2fM7")),f=a("MuoO"),_=a("LLXN"),v=a("7DNP"),k=l(a("q1tI")),b=r(a("4W9V")),L=r(a("e6Ls")),E=g.default.Option,R=c.default.Item,y=(p=c.default.create(),u=(0,f.connect)(),p(h=u((m=class extends k.PureComponent{constructor(e){super(e),this.onOk=(e=>{e.preventDefault();var t=this.props,a=t.form,r=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&r&&r(t)})}),this.fetchComponentVersion=(()=>{var e=this.props,t=e.dispatch,a=e.form,r=e.data,l=void 0===r?{}:r,s=e.team_name,n=e.group_id;a.setFieldsValue;t({type:"application/fetchComponentVersion",payload:{team_name:s,app_model_key:l.group_key,upgrade_group_id:l.upgrade_group_id,group_id:n},callback:e=>{e&&200===e.status_code&&this.setState({list:e.list}),this.handleCancel()},handleError:e=>{this.handleError(e)}})}),this.handleDeploy=(e=>{var t=this.props,a=t.team_name,r=t.dispatch,l=t.ok,s=this.props.form,n=e.service_alias;s.validateFields(["".concat(n)],(e,t)=>{e||(this.setState({loading:!0}),r({type:"appControl/putUpgrade",payload:{team_name:a,app_alias:n,group_version:t[n]},callback:e=>{e&&200===e.status_code&&(this.fetchComponentVersion(),l&&l(),d.default.success({message:(0,_.formatMessage)({id:"notification.success.upgrade_successfully"})}))},handleError:e=>{this.handleError(e)}}))})}),this.handleError=(e=>{(0,b.default)(e),this.handleCancel()}),this.handleCancel=(()=>{this.setState({loading:!1})}),this.state={loading:!0,list:[]}}componentDidMount(){this.fetchComponentVersion()}render(){var e=this.props,t=e.title,a=e.onCancel,r=e.form,l=(e.data,e.team_name),d=e.region_name,p=this.state,u=p.list,h=p.loading,m=r.getFieldDecorator,f=[{title:"\u7ec4\u4ef6\u540d\u79f0",dataIndex:"service_cname",key:"service_cname",width:180,render:(e,t)=>{return k.default.createElement(v.Link,{to:"/team/".concat(l,"/region/").concat(d,"/components/").concat(t.service_alias,"/overview")},e)}},{title:"\u5f53\u524d\u7248\u672c",dataIndex:"current_version",key:"current_version",width:180,render:e=>{return k.default.createElement(o.default,{title:e},k.default.createElement("div",{className:L.default.over},e))}},{title:"\u53ef\u5347\u7ea7\u7248\u672c",dataIndex:"upgradable_versions",key:"upgradable_versions",render:(e,t)=>{var a=e&&e.length>0&&e[0];return k.default.createElement(c.default,null,k.default.createElement(R,{style:{margin:0}},m("".concat(t.service_alias),{initialValue:a||"\u65e0",rules:[{required:!0,message:"\u4e0d\u80fd\u4e3a\u7a7a!"}]})(k.default.createElement(g.default,{disabled:!a,onChange:this.handleChange},e.map(e=>{return k.default.createElement(E,{key:e,value:e},e)})))))}},{title:"\u64cd\u4f5c",dataIndex:"component_id",rowKey:"component_id",align:"center",width:150,render:(e,t)=>{return t.upgradable_versions&&t.upgradable_versions.length>0?k.default.createElement(i.default,{type:"link",style:{padding:0},onClick:()=>{this.handleDeploy(t)}},"\u5347\u7ea7"):k.default.createElement("span",{style:{color:"rgba(0, 0, 0, 0.45)"}},"\u65e0\u53ef\u5347\u7ea7\u7684\u7248\u672c")}}];return k.default.createElement(s.default,{title:t||"\u7ec4\u4ef6\u5217\u8868",visible:!0,width:800,confirmLoading:h,className:L.default.TelescopicModal,onCancel:a,onOk:this.onOk,footer:[k.default.createElement(i.default,{style:{marginTop:"20px"},onClick:a},"\u5173\u95ed")]},k.default.createElement(n.default,{dataSource:u,columns:f,loading:h,pagination:!1}))}},h=m))||h)||h);t.default=y}}]);