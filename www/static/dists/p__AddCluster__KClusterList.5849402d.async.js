(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[18],{2457:function(e,t,a){e.exports={nameID:"nameID___lHOPc",icon:"icon___3bO_J",iconm:"iconm___1h3X6",cmd:"cmd___1CeOh",logline:"logline___2nRMf"}},"52ST":function(e,t,a){"use strict";var s=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var r=s(a("bx4M"));a("jCWc");var n=s(a("kPKH"));a("5Dmo");var d=s(a("3S7+"));a("14J3");var o=s(a("BMrR"));a("+L6B");var i=s(a("2/Rp")),u=s(a("jehZ"));a("y8nQ");var c=s(a("Vl3Y"));a("FJo9");var h,p,m,f,C=s(a("L41K")),g=s(a("18gR")),E=a("MuoO"),y=a("7DNP"),v=l(a("q1tI")),k=a("LLXN"),b=s(a("sQyZ")),_=s(a("VQ3Z")),M=s(a("LjLi")),I=s(a("s6ox")),w=s(a("5ov5")),S=s(a("XZXw")),x=s(a("AklW")),D=s(a("QDog")),F=s(a("+iC2")),T=C.default.Step,P=(h=c.default.create(),p=(0,E.connect)(e=>{var t=e.user,a=e.list,s=e.loading,l=e.global,r=e.index;return{user:t.currentUser,list:a,loading:s.models.list,rainbondInfo:l.rainbondInfo,enterprise:l.enterprise,isRegist:l.isRegist,oauthLongin:s.effects["global/creatOauth"],overviewInfo:r.overviewInfo}}),h(m=p((f=class extends v.PureComponent{constructor(e){super(e),this.startInit=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,s=a.eid,l=a.provider,r=this.state,n=r.selectClusterID,d=r.rainbondInit;t(y.routerRedux.push("/enterprise/".concat(s,"/provider/").concat(l,"/kclusters/").concat(n,"/").concat(d?"link":"init")))}),this.selectCluster=(e=>{this.setState({selectClusterID:e.clusterID,rainbondInit:e.rainbond_init})}),this.loadLastTask=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,s=a.eid,l=a.provider;t({type:"cloud/loadLastTask",payload:{enterprise_id:s,provider_name:l},callback:e=>{e&&(this.setState({lastTask:e,currentClusterID:e.clusterID}),"start"===e.status&&this.setState({showTaskDetail:!0}))},handleError:e=>{x.default.handleCloudAPIError(e)}})}),this.loadKubernetesCluster=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,s=a.eid,l=a.provider;this.setState({loading:!0}),t({type:"cloud/loadKubereneteClusters",payload:{enterprise_id:s,provider_name:l},callback:e=>{if(e&&e.clusters&&e.clusters.length>0){var t="running"===e.clusters[0].state;this.setState({k8sClusters:e.clusters,loading:!1}),t&&document.getElementById("initializeBtn").scrollIntoView(),this.loadRainbondClusters()}else"custom"!==l&&"rke"!==l||this.showBuyClusterConfig(),this.setState({loading:!1})},handleError:e=>{x.default.handleCloudAPIError(e),this.setState({loading:!1})}})}),this.handleStartLog=((e,t,a)=>{var s=this.props,l=s.match.params,r=l.eid,n=l.provider,d=s.rainbondInfo,o=s.enterprise;D.default.putInstallClusterLog(o,d,{eid:r,taskID:e,status:a?t:"start",install_step:"createK8s",provider:n})}),this.loadRainbondClusters=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"region/fetchEnterpriseClusters",payload:{enterprise_id:a,check_status:"no"},callback:e=>{if(e&&e.list){var t=new Map;e.list.map(e=>{return""!==e.provider_cluster_id&&t.set(e.provider_cluster_id,!0),e}),this.setState({linkedClusters:t})}}})}),this.showBuyClusterConfig=(()=>{this.setState({showBuyClusterConfig:!0})}),this.cancelAddCluster=(()=>{this.setState({showBuyClusterConfig:!1})}),this.cancelShowCreateDetail=(()=>{this.setState({showTaskDetail:!1}),this.loadKubernetesCluster()}),this.addClusterOK=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid;e(y.routerRedux.push("/enterprise/".concat(t,"/clusters")))}),this.preStep=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid;e(y.routerRedux.push("/enterprise/".concat(t,"/addCluster")))}),this.loadSteps=(()=>{var e=[{title:(0,k.formatMessage)({id:"enterpriseColony.addCluster.supplier"})},{title:(0,k.formatMessage)({id:"enterpriseColony.addCluster.cluster"})},{title:(0,k.formatMessage)({id:"enterpriseColony.addCluster.Initialize"})},{title:(0,k.formatMessage)({id:"enterpriseColony.addCluster.docking"})}];return e}),this.handleOk=((e,t,a)=>{this.setState(t),e&&e.taskID&&this.handleStartLog(e.taskID,e.status,a),this.cancelAddCluster(),this.loadKubernetesCluster()}),this.handleGuideStep=(e=>{this.setState({guideStep:e})}),this.handleNewbieGuiding=(e=>{var t=e.prevStep,a=e.nextStep,s=e.handleClick,l=void 0===s?()=>{}:s,r=e.handleClosed,n=void 0===r?()=>{}:r;return v.default.createElement(g.default,(0,u.default)({},e,{totals:14,handleClose:()=>{this.handleGuideStep("close"),this.selectCluster({clusterID:"",rainbond_init:!1}),n()},handlePrev:()=>{t&&this.handleGuideStep(t)},handleNext:()=>{a&&(l(),this.handleGuideStep(a))}}))}),this.renderCreateClusterShow=(()=>{var e=this.props.match.params,t=e.eid,a=e.provider,s=this.state.guideStep;switch(a){case"ack":return v.default.createElement(b.default,{eid:t,selectProvider:a,onCancel:()=>{this.cancelAddCluster()},onOK:e=>{var t={lastTask:e,showTaskDetail:!0,currentClusterID:e.clusterID};this.handleOk(e,t)}});case"tke":break;case"custom":return v.default.createElement(_.default,{eid:t,onCancel:()=>{this.cancelAddCluster()},onOK:e=>{var t={currentClusterID:e.clusterID};this.handleOk(e,t,!0)}});case"rke":return v.default.createElement(I.default,{eid:t,guideStep:s,handleNewbieGuiding:this.handleNewbieGuiding,onCancel:()=>{this.cancelAddCluster()},onOK:e=>{var t={lastTask:e,showTaskDetail:!0,currentClusterID:e.clusterID};this.handleOk(e,t)}});default:}});var t=this.props.user,a=F.default.isCompanyAdmin(t);this.state={adminer:a,showBuyClusterConfig:!1,k8sClusters:[],loading:!0,rainbondInit:!1,selectClusterID:"",showTaskDetail:!1,linkedClusters:new Map,lastTask:{},guideStep:3,currentClusterID:""}}componentWillMount(){var e=this.state.adminer,t=this.props.dispatch;e||t(y.routerRedux.push("/"))}componentDidMount(){this.loadKubernetesCluster(),this.loadLastTask()}render(){var e=this.props,t=e.match.params,a=t.eid,s=t.provider,l=e.location.query,u=l.clusterID,c=l.updateKubernetes,h=this.state,p=h.k8sClusters,m=h.showBuyClusterConfig,f=h.loading,g=h.selectClusterID,E=h.showTaskDetail,y=h.lastTask,b=h.linkedClusters,_=h.currentClusterID,I=h.guideStep,x=""===g,D="".concat((0,k.formatMessage)({id:"enterpriseColony.addCluster.host.Cluster_list"}));switch(s){case"ack":D+="".concat((0,k.formatMessage)({id:"enterpriseColony.addCluster.host.al"}));break;case"tke":D+="".concat((0,k.formatMessage)({id:"enterpriseColony.addCluster.host.tx"}));break;case"custom":D+="".concat((0,k.formatMessage)({id:"enterpriseColony.addCluster.host.zdy"}));break;case"rke":D+="".concat((0,k.formatMessage)({id:"enterpriseColony.addCluster.host.host_oneself"}));break;default:D+="".concat((0,k.formatMessage)({id:"enterpriseColony.addCluster.host.provider"},{provider:s}))}var F=v.default.createElement(i.default,{style:{marginLeft:"16px"},type:"primary",onClick:this.startInit,disabled:x,id:"initializeBtn"},v.default.createElement(k.FormattedMessage,{id:"button.next"})),P=!1,K="",L=!1;return p&&p.length&&p.map(e=>{var t=e.state;"running"===t&&(L=e.rainbond_init,K=e.cluster_id,P=!0)}),v.default.createElement(S.default,{title:v.default.createElement(k.FormattedMessage,{id:"enterpriseColony.button.text"}),content:v.default.createElement(k.FormattedMessage,{id:"enterpriseColony.PageHeaderLayout.content"})},v.default.createElement(o.default,{style:{marginBottom:"16px"}},v.default.createElement(C.default,{current:1},this.loadSteps().map(e=>v.default.createElement(T,{key:e.title,title:e.title})))),v.default.createElement(r.default,{title:D},v.default.createElement(M.default,{eid:a,loading:f,loadKubernetesCluster:this.loadKubernetesCluster,selectCluster:this.selectCluster,selectProvider:s,data:p,lastTask:y,showLastTaskDetail:()=>{this.setState({showTaskDetail:!0})},guideStep:I,handleNewbieGuiding:this.handleNewbieGuiding,loadLastTask:this.loadLastTask,linkedClusters:b,showBuyClusterConfig:this.showBuyClusterConfig,updateKubernetes:c,updateKubernetesClusterID:u}),!P||3!==I&&8!==I?"":this.handleNewbieGuiding({tit:(0,k.formatMessage)({id:"enterpriseColony.addCluster.host.select_the_cluster"}),desc:(0,k.formatMessage)({id:"enterpriseColony.addCluster.host.cluster"}),send:!1,configName:"kclustersInitializationCluster",nextStep:9,svgPosition:{left:"44px",marginTop:"-35px"},handleClick:()=>{this.selectCluster({clusterID:K,rainbond_init:L})}}),m&&this.renderCreateClusterShow(),v.default.createElement(n.default,{style:{textAlign:"center",marginTop:"32px"},span:24},v.default.createElement(i.default,{onClick:this.preStep},v.default.createElement(k.FormattedMessage,{id:"button.previous"})),x?v.default.createElement(d.default,{title:(0,k.formatMessage)({id:"enterpriseColony.addCluster.host.select_the_cluster"})},F):F,P&&9===I?this.handleNewbieGuiding({tit:(0,k.formatMessage)({id:"enterpriseColony.addCluster.host.Rainbond"}),desc:(0,k.formatMessage)({id:"enterpriseColony.addCluster.host.install"}),send:!0,configName:"kclustersInitializationCluster",nextStep:10,conPosition:{left:"60%",bottom:"-24px"},svgPosition:{left:"54%",marginTop:"-11px"},handleClick:()=>{x||this.startInit()}}):""),E&&y&&v.default.createElement(w.default,{onCancel:this.cancelShowCreateDetail,eid:a,selectProvider:s,taskID:y.taskID,clusterID:_})))}},m=f))||m)||m);t.default=P},"5ov5":function(e,t,a){"use strict";var s=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,n,d,o=s(a("jehZ")),i=a("MuoO"),u=l(a("q1tI")),c=s(a("AklW")),h=s(a("QDog")),p=s(a("UBd8")),m=a("LLXN"),f=(r=(0,i.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo,enterprise:t.enterprise}}),r((d=class extends u.PureComponent{constructor(e){super(e),this.refresh=!0,this.loadTask=(()=>{var e=this.props,t=e.dispatch,a=e.eid,s=e.taskID;t({type:"cloud/loadTask",payload:{enterprise_id:a,taskID:s},callback:e=>{e&&this.setState({complete:"complete"===e.status})},handleError:e=>{c.default.handleCloudAPIError(e),this.setState({loading:!1})}})}),this.loadTaskEvents=(()=>{var e=this.props,t=e.dispatch,a=e.eid,s=e.taskID,l=e.rainbondInfo,r=e.enterprise;t({type:"cloud/loadTaskEvents",payload:{enterprise_id:a,taskID:s},callback:e=>{if(e){var t=c.default.showCreateKubernetesSteps(e.events),n=t.complete,d=t.steps;n&&d&&d.length>0&&h.default.putInstallClusterLog(r,l,{eid:a,taskID:s,status:d[d.length-1].Status,message:d[d.length-1].Message,install_step:"createK8s",provider:"rke"}),this.setState({complete:n,loading:!1,steps:d}),this.refresh&&!n&&setTimeout(()=>{this.loadTaskEvents()},4e3)}},handleError:e=>{c.default.handleCloudAPIError(e),this.setState({loading:!1}),this.refresh&&setTimeout(()=>{this.loadTaskEvents()},8e3)}})}),this.queryCreateLog=(()=>{this.setState({showCreateLog:!0})}),this.state={loading:!0,complete:!1,steps:[],showCreateLog:!1}}componentDidMount(){this.loadTask(),this.loadTaskEvents()}componentWillUnmount(){this.refresh=!1}render(){var e=this.props.title;return u.default.createElement(p.default,(0,o.default)({title:e||u.default.createElement(m.FormattedMessage,{id:"enterpriseColony.ShowKubernetesCreateDetail.msg"}),msg:(0,m.formatMessage)({id:"enterpriseColony.ShowKubernetesCreateDetail.msg"})},this.state,this.props))}},n=d))||n),C=f;t.default=C},LjLi:function(e,t,a){"use strict";var s=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var r=s(a("kLXV"));a("g9YV");var n=s(a("wCAj"));a("14J3");var d=s(a("BMrR"));a("P2fV");var o=s(a("NJEC"));a("+L6B");var i=s(a("2/Rp"));a("5Dmo");var u=s(a("3S7+"));a("7Kak");var c=s(a("9yH6"));a("jCWc");var h=s(a("kPKH"));a("Pwec");var p=s(a("CtXQ"));a("/xke");var m=s(a("TeRw"));a("miYZ");var f=s(a("tsqr"));a("tU7J");var C,g,E,y=s(a("wFql")),v=s(a("+QRC")),k=a("MuoO"),b=l(a("q1tI")),_=a("LLXN"),M=s(a("9tdr")),I=a("ArA+"),w=a("mLYH"),S=s(a("AklW")),x=s(a("dBUJ")),D=s(a("imTl")),F=s(a("3//m")),T=s(a("s6ox")),P=s(a("gtfS")),K=s(a("T8HY")),L=s(a("2457")),N=y.default.Paragraph,A=(C=(0,k.connect)(),C((E=class extends b.PureComponent{constructor(e){super(e),this.handleLoadInitNodeCmd=(()=>{var e=this.props.dispatch;e({type:"cloud/getInitNodeCmd",callback:e=>{this.setState({initCmd:e&&e.response_data&&e.response_data.cmd||""})}})}),this.autoPage=(()=>{var e=this.props,t=e.updateKubernetes,a=e.updateKubernetesClusterID;t&&a&&this.updateCluster(a)}),this.queryCreateLog=(e=>{this.setState({showCreateLog:!0,clusterID:e.cluster_id})}),this.reInstallCluster=(e=>{var t=this.props,a=t.dispatch,s=t.eid,l=t.selectProvider,r=t.loadKubernetesCluster,n=t.loadLastTask;if("rke"!==l)return f.default.warning("\u8be5\u63d0\u4f9b\u5546\u4e0d\u652f\u6301\u96c6\u7fa4\u91cd\u88c5"),void this.handleInstallLoading(!1);a({type:"cloud/reInstall",payload:{enterprise_id:s,clusterID:e},callback:e=>{this.handleInstallRemind(!1),this.handleInstallLoading(!1),e&&(r&&r(),n&&n())},handleError:e=>{this.handleInstallLoading(!1),S.default.handleCloudAPIError(e)}})}),this.updateCluster=(e=>{var t=this.props,a=t.eid,s=t.selectProvider;(0,w.getUpdateKubernetesTask)({clusterID:e,providerName:s,enterprise_id:a},e=>{S.default.handleCloudAPIError(e)}).then(t=>{t.task&&"complete"!==t.task.status?this.setState({showUpdateKubernetesTasks:!0,updateTask:t.task}):this.setState({showUpdateKubernetes:!0,nodeList:t.nodeList,rkeConfig:t.rkeConfig,updateClusterID:e})}).catch(e=>{console.log(e)})}),this.uninstallCluster=(e=>{var t=this.props,a=t.eid,s=t.selectProvider;(0,w.uninstallRegion)({provider_name:s,enterprise_id:a,clusterID:e},e=>{S.default.handleCloudAPIError(e)}).then(e=>{e&&200===e.status_code&&m.default.success({message:(0,_.formatMessage)({id:"notification.success.cluster_uninstalled"})})})}),this.handleInstallLoading=(e=>{this.setState({installLoading:e})}),this.handleInstallRemind=(e=>{this.setState({isInstallRemind:e})}),this.handleCommandBox=(e=>{return b.default.createElement(h.default,{span:24,style:{marginTop:"16px"}},b.default.createElement("span",{className:P.default.cmd},b.default.createElement(p.default,{className:P.default.copy,type:"copy",onClick:()=>{(0,v.default)(e),m.default.success({message:(0,_.formatMessage)({id:"notification.success.copy"})})}}),e))}),this.cancelShowUpdateKubernetes=(()=>{var e=this.props.loadKubernetesCluster;this.setState({showUpdateKubernetesTasks:!1,updateTask:null}),e&&e()}),this.getKubeConfig=(e=>{var t=this.props,a=t.eid,s=t.selectProvider;(0,w.getKubeConfig)({clusterID:e,enterprise_id:a,providerName:s}).then(e=>{200===e.status_code&&this.setState({kubeConfig:e.config})})}),this.handleIsComponents=(e=>{this.setState({isComponents:e})}),this.state={selectClusterName:"",clusterID:"",showCreateLog:!1,isInstallRemind:!1,installLoading:!1,isComponents:!1,initCmd:null}}componentDidMount(){this.autoPage(),this.handleLoadInitNodeCmd()}deleteCluster(e){var t=this.props,a=t.dispatch,s=t.eid,l=t.selectProvider,r=t.loadKubernetesCluster;a({type:"cloud/deleteKubernetesCluster",payload:{enterprise_id:s,providerName:l,clusterID:e},callback:()=>{r&&r()},handleError:e=>{S.default.handleCloudAPIError(e)}})}render(){var e=this.props,t=e.selectProvider,a=e.linkedClusters,s=e.eid,l=e.selectCluster,f=this.state,C=f.selectClusterName,g=f.initCmd,E=[{width:50,dataIndex:"radio",render:(e,t)=>{var s=t.cluster_id,r="running"!==t.state||a.get(s)||t.parameters&&t.parameters.DisableRainbondInit,n=t.parameters&&t.parameters.Message,d=t.name;return b.default.createElement(u.default,{title:n},b.default.createElement(c.default,{disabled:r,checked:C===d,onClick:()=>{r||(this.setState({selectClusterName:d}),l&&l({clusterID:s,name:d,can_init:t.can_init,rainbond_init:t.state&&"running"===t.state&&t.rainbond_init}))}},e))}},{title:(0,_.formatMessage)({id:"enterpriseColony.addCluster.host.name"}),width:120,dataIndex:"name",render:(e,t)=>{var a="".concat(e,"(").concat(t.cluster_id,")");return b.default.createElement(u.default,{title:a},b.default.createElement("div",{className:L.default.nameID},a))}},{title:(0,_.formatMessage)({id:"enterpriseColony.addCluster.host.cluster_type"}),width:180,dataIndex:"cluster_type",render:e=>{return S.default.getAliyunClusterName(e)}}];"custom"!==t&&"rke"!==t?(E.push({title:(0,_.formatMessage)({id:"enterpriseColony.addCluster.host.region_id"}),dataIndex:"region_id",render:e=>{return S.default.getAliyunRegionName(e)}}),E.push({title:(0,_.formatMessage)({id:"enterpriseColony.addCluster.host.zone_id"}),dataIndex:"zone_id"})):E.push({title:(0,_.formatMessage)({id:"enterpriseColony.addCluster.host.master_url"}),width:300,dataIndex:"master_url.api_server_endpoint"}),E.push({title:(0,_.formatMessage)({id:"enterpriseColony.addCluster.host.size"}),width:100,dataIndex:"size"}),E.push({title:(0,_.formatMessage)({id:"enterpriseColony.addCluster.host.current_version"}),width:250,dataIndex:"current_version"}),E.push({title:(0,_.formatMessage)({id:"enterpriseColony.addCluster.host.state"}),width:150,dataIndex:"state",render:(e,t)=>{return S.default.getAliyunClusterStatus(e,t,a)}}),E.push({title:(0,_.formatMessage)({id:"enterpriseColony.addCluster.host.cluster_id"}),dataIndex:"cluster_id",render:(e,l)=>{return b.default.createElement("div",null,"running"===l.state&&b.default.createElement("a",{onClick:()=>this.getKubeConfig(l.cluster_id||l.name)},"KubeConfig"),"failed"===l.state&&"rke"===t&&b.default.createElement("a",{onClick:()=>{this.handleInstallRemind(l.cluster_id||l.name)}},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.Reinstall"})),!0===l.rainbond_init&&!a.get(l.cluster_id)&&b.default.createElement(I.Link,{to:"/enterprise/".concat(s,"/provider/").concat(t,"/kclusters/").concat(l.cluster_id,"/link")},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.Docking"})),"rke"!==t&&l.create_log_path&&l.create_log_path.startsWith("http")&&b.default.createElement(i.default,{type:"link",style:{padding:0},onClick:()=>{window.open(l.create_log_path,"_blank")}},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.view_log"})),"rke"===t&&b.default.createElement(i.default,{type:"link",style:{padding:0},onClick:()=>{this.queryCreateLog(l)}},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.view_log"})),!l.rainbond_init&&("rke"===t||"custom"===t)&&b.default.createElement(o.default,{placement:"top",title:b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.current_cluster"}),onConfirm:()=>{this.deleteCluster(l.cluster_id||l.name)},okText:b.default.createElement(_.FormattedMessage,{id:"button.confirm"}),cancelText:b.default.createElement(_.FormattedMessage,{id:"button.cancel"})},b.default.createElement("a",null,b.default.createElement(_.FormattedMessage,{id:"button.delete"}))),"rke"===t&&b.default.createElement("a",{onClick:()=>this.updateCluster(l.cluster_id||l.name)},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.Cluster_configuration"})),"running"===l.state&&("rke"===t||"custom"===t)&&b.default.createElement("a",{onClick:()=>this.handleIsComponents(l.cluster_id)},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.look"})),!0===l.rainbond_init&&b.default.createElement(o.default,{placement:"top",title:b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.After_uninstallation"}),onConfirm:()=>{this.uninstallCluster(l.cluster_id||l.name)},okText:b.default.createElement(_.FormattedMessage,{id:"button.confirm"}),cancelText:b.default.createElement(_.FormattedMessage,{id:"button.cancel"})},b.default.createElement("a",null,b.default.createElement(_.FormattedMessage,{id:"button.uninstall"}))))}});var y=this.props,k=y.data,w=y.showBuyClusterConfig,A=y.loadKubernetesCluster,R=y.loading,B=y.lastTask,O=y.showLastTaskDetail,V=this.state,U=V.clusterID,q=V.kubeConfig,j=V.showUpdateKubernetes,W=V.nodeList,X=V.rkeConfig,z=V.updateClusterID,G=V.showUpdateKubernetesTasks,J=V.updateTask,Q=V.showCreateLog,Z=V.installLoading,H=V.isComponents,Y=V.isInstallRemind,$="docker rm -vf $(docker ps -a | grep 'rke-tools\\|hyperkube\\|coreos-etcd\\|k8s' | awk '{print $1}')",ee="rm -rf /var/lib/etcd /etc/kubernetes /etc/cni /opt/cni /var/lib/cni /var/run/calico /opt/rke";return b.default.createElement("div",null,b.default.createElement(d.default,{style:{marginBottom:"20px"}},"ack"===t&&b.default.createElement(h.default,{span:24,style:{padding:"16px"}},b.default.createElement(N,{className:x.default.describe},b.default.createElement("ul",null,b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.managed"}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.click"}),b.default.createElement(i.default,{type:"link",onClick:w},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.Newly"})),b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.Quick"}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.try_again"}),S.default.getAliyunCountDescribe().map(e=>{return b.default.createElement("a",{style:{marginRight:"8px"},href:e.href,target:"_blank",rel:"noreferrer"},e.title)}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.successfully"})))))),b.default.createElement(h.default,{span:12,style:{textAlign:"left"}},C&&b.default.createElement("span",{style:{marginRight:"16px"}},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.Cluster_selected"})," ",C,",",b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.cluster_complies"})),!C&&B&&B.name&&O&&b.default.createElement("span",null,b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.Last_created"}),B.name,",",b.default.createElement(i.default,{onClick:O,type:"link"},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.creation_progress"})))),b.default.createElement(h.default,{span:12,style:{textAlign:"right"}},b.default.createElement(i.default,{type:"primary",onClick:w},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.add"})),b.default.createElement(i.default,{style:{marginLeft:"16px"},onClick:A},b.default.createElement(p.default,{type:"reload"})))),b.default.createElement(n.default,{scroll:{x:!(window.innerWidth>1500)&&1500},loading:R,pagination:!1,columns:E,dataSource:k}),Y&&b.default.createElement(r.default,{title:b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.reinstall_current_cluster"}),confirmLoading:Z,className:P.default.TelescopicModal,width:900,visible:!0,onOk:()=>{this.handleInstallLoading(!0),this.reInstallCluster(Y)},onCancel:()=>{this.handleInstallRemind(!1)}},b.default.createElement(d.default,{style:{padding:"0 16px"}},b.default.createElement("span",{style:{fontWeight:600,color:"red"}},b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.following"}),b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.commands"}),b.default.createElement("br",null),b.default.createElement(_.FormattedMessage,{id:"enterpriseColony.addCluster.host.permission"})),this.handleCommandBox($),this.handleCommandBox(ee),this.handleCommandBox(g))),Q&&b.default.createElement(F.default,{eid:s,clusterID:U,selectProvider:t,onCancel:()=>{this.setState({clusterID:"",showCreateLog:!1})}}),q&&b.default.createElement(r.default,{visible:!0,width:1e3,maskClosable:!1,onCancel:()=>{this.setState({kubeConfig:""})},title:"KubeConfig",bodyStyle:{background:"#000"},onOk:()=>{(0,v.default)(q),m.default.success({message:(0,_.formatMessage)({id:"notification.success.copy"})})},okText:b.default.createElement(_.FormattedMessage,{id:"button.copy"})},b.default.createElement("div",{className:L.default.cmd},b.default.createElement(M.default,{value:q,options:{mode:{name:"javascript",json:!0},lineNumbers:!0,theme:"seti",lineWrapping:!0,smartIndent:!0,matchBrackets:!0,scrollbarStyle:null,showCursorWhenSelecting:!0,height:500}}))),j&&b.default.createElement(T.default,{eid:s,onOK:e=>{this.setState({clusterID:e.clusterID,showUpdateKubernetes:!1,updateTask:e,showUpdateKubernetesTasks:!0})},onCancel:()=>{this.setState({showUpdateKubernetes:!1})},clusterID:z,nodeList:W,rkeConfig:X}),G&&b.default.createElement(K.default,{eid:s,clusterID:U,task:J,selectProvider:t,onCancel:this.cancelShowUpdateKubernetes}),H&&b.default.createElement(D.default,{eid:s,clusterID:H,providerName:t,onCancel:()=>{this.handleIsComponents(!1)}}))}},g=E))||g);t.default=A},T8HY:function(e,t,a){"use strict";var s=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,n,d,o=s(a("jehZ")),i=a("MuoO"),u=l(a("q1tI")),c=a("LLXN"),h=s(a("AklW")),p=s(a("QDog")),m=s(a("UBd8")),f=(r=(0,i.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo,enterprise:t.enterprise}}),r((d=class extends u.PureComponent{constructor(e){super(e),this.refresh=!0,this.loadTaskEvents=(()=>{var e=this.props,t=e.dispatch,a=e.eid,s=e.task,l=e.selectProvider,r=e.enterprise,n=e.rainbondInfo;t({type:"cloud/loadTaskEvents",payload:{enterprise_id:a,taskID:s.taskID},callback:e=>{if(e){var t=h.default.showUpdateClusterSteps(e.events),d=t.complete,o=t.steps;d&&o.length>0&&p.default.putInstallClusterLog(r,n,{eid:a,taskID:s.taskID,status:o[o.length-1].Status,message:o[o.length-1].Message,install_step:"createK8s",provider:l}),this.setState({complete:d,loading:!1,steps:o}),!d&&this.refresh&&setTimeout(()=>this.loadTaskEvents(),4e3)}},handleError:e=>{h.default.handleCloudAPIError(e),this.setState({loading:!1})}})}),this.state={loading:!0,complete:!1,steps:[]}}componentDidMount(){this.loadTaskEvents()}componentWillUnmount(){this.refresh=!1}render(){var e=this.props.title;return u.default.createElement(m.default,(0,o.default)({title:e||u.default.createElement(c.FormattedMessage,{id:"enterpriseColony.ShowUpdateClusterDetail.title"}),msg:u.default.createElement(c.FormattedMessage,{id:"enterpriseColony.ShowUpdateClusterDetail.msg"})},this.state,this.props))}},n=d))||n),C=f;t.default=C},gtfS:function(e,t,a){e.exports={nameID:"nameID___3Iawl",icon:"icon___Vw_QE",iconm:"iconm___3oFjI",describe:"describe___K7ShE","editable-cell":"editable-cell___2hRGL","editable-cell-value-wrap":"editable-cell-value-wrap___3VH19","editable-row":"editable-row___2R9L_",cmd:"cmd___1wxk3",copy:"copy___3mXdm"}},s6ox:function(e,t,a){"use strict";(function(e){var s=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("g9YV");var r=s(a("wCAj"));a("fOrg");var n=s(a("+KLJ"));a("2qtc");var d=s(a("kLXV"));a("14J3");var o=s(a("BMrR"));a("jCWc");var i=s(a("kPKH"));a("Pwec");var u=s(a("CtXQ"));a("+L6B");var c=s(a("2/Rp"));a("P2fV");var h=s(a("NJEC"));a("+BJd");var p=s(a("mr32"));a("miYZ");var m=s(a("tsqr"));a("/xke");var f=s(a("TeRw"));a("5Dmo");var C=s(a("3S7+"));a("5NDa");var g=s(a("5rEg"));a("giR+");var E=s(a("fyUT"));a("OaEy");var y=s(a("2fM7")),v=s(a("p0pE"));a("y8nQ");var k=s(a("Vl3Y")),b=s(a("Y/ft"));a("Znn+");var _=s(a("ZTPi"));a("tU7J");var M,I,w,S,x=s(a("wFql")),D=s(a("ZNrE")),F=s(a("+QRC")),T=a("MuoO"),P=l(a("q1tI")),K=a("LLXN"),L=a("mLYH"),N=s(a("AklW")),A=s(a("gtfS")),R=x.default.Paragraph,B=_.default.TabPane,O=/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/,V=/^[1-9]\d*$/,U=P.default.createContext(),q=e=>{var t=e.form,a=(e.index,(0,b.default)(e,["form","index"]));return P.default.createElement(U.Provider,{value:t},P.default.createElement("tr",a))},j=k.default.create()(q);class W extends P.default.Component{constructor(){super(...arguments),this.state={editing:!1},this.toggleEdit=(()=>{var e=!this.state.editing;this.setState({editing:e},()=>{e&&this.input.focus()})}),this.save=((e,t)=>{var a=this.props,s=a.record,l=a.handleSave;this.form.validateFields((a,r)=>{l((0,v.default)({},s,r)),a&&a[t||e&&e.currentTarget.id]||this.toggleEdit()})}),this.renderCell=(e=>{this.form=e;var t=this.props,a=t.children,s=t.dataIndex,l=t.record,r=t.title,n=t.dataSource,d=this.state.editing,o=[{required:!0,message:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.Required"},{title:r})}],i="ip"===s||"internalIP"===s;i&&o.push({message:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.correct_IP"}),pattern:new RegExp(O,"g")});var u="sshPort"===s;u&&o.push({message:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.Correct_port"}),min:1,max:65536,pattern:new RegExp(V,"g")});var c=l[s];return d||i&&!c?P.default.createElement(k.default.Item,{style:{margin:0}},e.getFieldDecorator(s,{rules:o,initialValue:c})("roles"===s?P.default.createElement(y.default,{getPopupContainer:e=>e.parentNode,ref:e=>this.input=e,onPressEnter:this.save,onBlur:()=>{this.save(!1,s)},allowClear:!0,mode:"multiple"},P.default.createElement(y.default.Option,{value:"controlplane"},P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.Administration"})),P.default.createElement(y.default.Option,{value:"etcd"},"ETCD"),P.default.createElement(y.default.Option,{value:"worker"},P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.calculation"}))):u?P.default.createElement(E.default,{style:{width:"100%"},ref:e=>this.input=e,onPressEnter:this.save,onBlur:this.save,min:1,max:65536}):P.default.createElement(g.default,{placeholder:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.placese_input"},{title:r}),ref:e=>{this.input=e,"ip"===s&&!c&&n&&n.length>1&&e.focus()},onPressEnter:this.save,onBlur:this.save,style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",width:"100%"}}))):P.default.createElement(C.default,{title:P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.click_edit"})},P.default.createElement("div",{className:"editable-cell-value-wrap",style:{cursor:"pointer"},onClick:this.toggleEdit},a))})}componentWillMount(){var e=this.props.handleClustersMount;e&&e(this)}render(){var e=this.props,t=e.editable,a=e.children,s=(0,b.default)(e,["editable","children"]);return P.default.createElement("td",s,t?P.default.createElement(U.Consumer,null,this.renderCell):a)}}var X=(M=k.default.create(),I=(0,T.connect)(),M(w=I((S=class extends P.PureComponent{constructor(t){var a;super(t),a=this,this.componentDidMount=(()=>{var e=this.props.clusterID;this.loadInitNodeCmd(),this.loadClusters(),e?this.setNodeList():(this.fetchRkeconfig(),this.handleAdd())}),this.loadClusters=(()=>{var e=this.props,t=e.dispatch,a=e.eid;t({type:"region/fetchEnterpriseClusters",payload:{enterprise_id:a},callback:e=>{if(e&&e.list){var t=[];e.list.map((e,a)=>{return e.key="cluster".concat(a),t.push(e),e}),this.setState({clusters:t})}else this.setState({clusters:[]})}})}),this.setNodeList=(()=>{var e=this.props,t=e.nodeList,a=e.rkeConfig,s=e.form,l=s.setFieldsValue;if(t&&t.length>0)for(var r=0;r<t.length;r++)t[r].key=Math.random(),t[r].sshPort&&0!==t[r].sshPort||(t[r].sshPort=22),t[r].disable=!0;if(a){var n=this.decodeBase64Content(a);l({yamls:n}),this.setState({yamlVal:n})}this.setState({dataSource:t||[],count:t&&t.length||0})}),this.handleClustersMount=(e=>{this.clusters=e}),this.encodeBase64Content=(t=>{var a=e.from(t).toString("base64");return a}),this.decodeBase64Content=(t=>{var a=t.replace(/\s/g,"+");return a=e.from(a,"base64").toString(),a}),this.loadInitNodeCmd=(()=>{var e=this.props.dispatch;e({type:"cloud/getInitNodeCmd",callback:e=>{var t=e&&e.response_data||{},a=e&&e.response_data&&e.data||{},s=e&&e.cmd||a.cmd||t.cmd;this.setState({initNodeCmd:s})}})}),this.fetchRkeconfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,s=a.props,l=s.form,r=s.eid,n=a.state.activeKey,d=l.setFieldsValue,o=Object.assign({},e,{enterprise_id:r});(0,L.rkeconfig)(o).then(e=>{if(e&&200===e.status_code&&e.response_data){var s=e.response_data||{},l=s.encodeRKEConfig,r=s.nodes,o=a.decodeBase64Content(l);d({yamls:o});var i="",u="";r&&(r&&r.length&&r.map(e=>{e.key=Math.random(),t&&(O.test(e.ip||"")?O.test(e.internalIP||"")?V.test(e.sshPort||"")?e.sshPort>65536?(u="sshPort",i="".concat((0,K.formatMessage)({id:"enterpriseColony.addCluster.host.port_max"}))):e.roles||(u="roles",i="".concat((0,K.formatMessage)({id:"enterpriseColony.addCluster.host.mast"}))):(i="".concat((0,K.formatMessage)({id:"enterpriseColony.addCluster.host.input_port"})),u="sshPort"):(i="".concat((0,K.formatMessage)({id:"enterpriseColony.addCluster.host.input_ip"})),u="internalIP"):(i="".concat((0,K.formatMessage)({id:"enterpriseColony.addCluster.host.input_ip"})),u="ip"))}),i&&a.handleCheck(!1),a.setState({helpType:u,helpError:i,dataSource:r})),a.setState({yamlVal:o}),"1"===n&&t&&i&&f.default.warning({message:i}),t&&!i&&a.handleStartCheck(t)}}).catch(e=>{if(e){var s=e.data?e.data.code:e.code;if(!s)return t&&a.setState({activeKey:"2"}),a.setState({isCheck:!1,helpType:"RKE",helpError:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.rke"})}),null}a.handleCheck(!1),N.default.handleCloudAPIError(e)})},this.updateCluster=(()=>{var e=this.props,t=e.dispatch,a=e.eid,s=e.clusterID,l=e.form,r=this.state,n=r.dataSource,d=r.yamlVal;n&&0===n.length&&m.default.warning("\u8bf7\u5b9a\u4e49\u96c6\u7fa4\u8282\u70b9"),l.validateFields((e,l)=>{e||(this.setState({loading:!0}),t({type:"cloud/updateKubernetesCluster",payload:{enterprise_id:a,clusterID:s,provider:"rke",encodedRKEConfig:this.encodeBase64Content(l.yamls||d)},callback:e=>{this.handleOk(e&&e.response_data)},handleError:e=>{this.handleError(e)}}))})}),this.createCluster=(()=>{var e=this.props,t=e.form,a=e.dispatch,s=e.eid,l=e.clusterID;if(l)return this.updateCluster(),null;t.validateFields((e,t)=>{e||(this.setState({loading:!0}),a({type:"cloud/createKubernetesCluster",payload:(0,v.default)({enterprise_id:s,provider_name:"rke",encodedRKEConfig:this.encodeBase64Content(t.yamls)},t),callback:e=>{this.handleOk(e)},handleError:e=>{this.handleError(e)}}))})}),this.handleOk=(e=>{var t=this.props.onOK;e&&t&&t(e||{})}),this.handleError=(e=>{var t=this.props.onOK;e&&e.data&&7005===e.data.code&&t?t(e.data.data):(N.default.handleCloudAPIError(e),this.setState({loading:!1}))}),this.handleDelete=(e=>{var t=[...this.state.dataSource];this.setState({dataSource:t.filter(t=>t.key!==e)})}),this.handleEnvGroup=((e,t)=>{return this.clusters&&this.clusters.form?this.clusters.form.validateFields({force:!0},a=>{if(!a&&e)return e();t()}):t&&t(),!1}),this.handleAdd=(()=>{var e=this.state,t=e.count,a=e.dataSource,s={key:Math.random(),ip:"",internalIP:"",sshPort:22,roles:["etcd","controlplane","worker"]};t>2&&(s.roles=["worker"]);var l=()=>{this.setState({dataSource:[...a,s],count:t+1})};this.handleEnvGroup(l,l)}),this.handleSave=(e=>{var t=[...this.state.dataSource],a=t.findIndex(t=>e.key===t.key),s=t[a];t.splice(a,1,(0,v.default)({},s,e)),this.setState({dataSource:t})}),this.beforeUpload=((e,t)=>{var a=e.name.split("."),s=a.length,l="yaml"===a[s-1]||"yml"===a[s-1];return!!l||(t&&f.default.warning({message:(0,K.formatMessage)({id:"notification.warn.yaml_file"})}),!1)}),this.nodeRole=(e=>{switch(e){case"controlplane":return"".concat((0,K.formatMessage)({id:"enterpriseColony.addCluster.host.Administration"}));case"worker":return"".concat((0,K.formatMessage)({id:"enterpriseColony.addCluster.host.calculation"}));case"etcd":return"ETCD";default:return"".concat((0,K.formatMessage)({id:"enterpriseColony.addCluster.host.unkonw"}))}}),this.handleStartCheck=(e=>{var t=!1,a=this.state.activeKey;"1"===a?this.handleEnvGroup(()=>{t=!0},()=>{this.handleActiveKey("1"),this.handleCheck(!1)}):t=!0,this.props.form.validateFields(e=>{t&&e&&e.yamls&&(this.handleActiveKey("2"),t=!1),e&&e.yamls&&this.setState({isCheck:!1,helpType:"RKE",helpError:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.input_rke"})}),!e&&t&&(console.log("2"),this.handleCheck(t))}),t&&e&&this.createCluster()}),this.handleCheck=(e=>{this.setState({isCheck:e,forbiddenConfig:!0,countNum:15,countConfig:!0,countContent:null},()=>{var t=this.props.guideStep;e&&7!==t&&this.handleCountDown(),!e&&clearInterval(this.timerId)})}),this.handleActiveKey=(e=>{this.setState({activeKey:e})}),this.handleTabs=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=a.state,l=s.dataSource,r=s.yamlVal,n=a.props.form,d=n.getFieldValue,o={},i=d("yamls")||r;(i||l&&l.length>0)&&("2"===e?(o.nodes=l,o.encodedRKEConfig=i&&a.encodeBase64Content(i)):o.encodedRKEConfig=i&&a.encodeBase64Content(i)),a.fetchRkeconfig(o,t),t||a.handleActiveKey("".concat(e))},this.handleCountDown=(()=>{var e=this.state.countNum;this.setState({countConfig:!1,countContent:"".concat(e,"s")}),this.timerId=setInterval(()=>{if(this.setState({countNum:e--,countContent:"".concat(e,"s")}),e<0)return clearInterval(this.timerId),this.setState(()=>({forbiddenConfig:!1,countConfig:!0})),null},1e3)}),this.state={loading:!1,dataSource:[],count:0,isCheck:!1,yamlVal:"",initNodeCmd:"",activeKey:"1",helpError:"",helpType:"",forbiddenConfig:!0,countConfig:!0,countNum:15,countContent:null,clusters:null},this.clusters=[]}render(){var e=this.props,t=e.onCancel,a=e.form,s=e.clusterID,l=e.guideStep,m=e.handleNewbieGuiding,C=a.getFieldDecorator,E=a.setFieldsValue,y=this.state,b=y.helpType,M=y.helpError,I=y.loading,w=y.dataSource,S=y.initNodeCmd,x=y.isCheck,T=y.activeKey,L=y.yamlVal,N=y.forbiddenConfig,O=y.countContent,V=y.countConfig,U=y.clusters,q={labelCol:{xs:{span:3}},wrapperCol:{xs:{span:24}}},X={body:{row:j,cell:W}},z=[{title:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.ip"}),dataIndex:"ip",width:150,editable:!0},{title:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.Intranet_ip"}),dataIndex:"internalIP",width:170,editable:!0},{title:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.ssh"}),dataIndex:"sshPort",width:140,editable:!0},{title:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.Node_type"}),dataIndex:"roles",width:160,editable:!0,render:e=>e&&e.length>0&&e.map(e=>P.default.createElement(p.default,{color:"blue"},this.nodeRole(e)))},{title:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.operation"}),dataIndex:"name",width:80,align:"center",render:(e,t)=>{return w&&w.length>1?P.default.createElement(h.default,{title:P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.delete"}),onConfirm:()=>this.handleDelete(t.key)},P.default.createElement("a",null,P.default.createElement(K.FormattedMessage,{id:"button.delete"}))):"-"}}],G=z.map(e=>{return e.editable?(0,v.default)({},e,{onCell:t=>{return{record:t,helpType:b,helpError:M,index:t.key,editable:e.editable,dataIndex:e.dataIndex,title:e.title,dataSource:w,handleClustersMount:this.handleClustersMount,handleSave:this.handleSave}}}):e}),J={position:"relative",zIndex:1e3,background:"#fff"};return P.default.createElement(d.default,{visible:!0,title:s?P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.Configure_cluster"}):P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.Host"}),className:A.default.TelescopicModal,width:900,destroyOnClose:!0,footer:P.default.createElement(P.Fragment,null,P.default.createElement(c.default,{type:"primary",onClick:()=>{this.handleStartCheck()},loading:I},s?P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.updata"}):P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.start_install"})),l&&6===l&&m&&U&&0===U.length&&P.default.createElement(P.Fragment,null,m({tit:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.start_install_six"}),send:!0,configName:"kclustersAttention",desc:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.Start_installation_now"}),nextStep:7,btnText:(0,K.formatMessage)({id:"button.install"}),conPosition:{right:"110px",bottom:0},svgPosition:{right:"50px",marginTop:"-11px"},handleClick:()=>{this.handleStartCheck()}}))),confirmLoading:I,onCancel:t,maskClosable:!1},x&&P.default.createElement(d.default,{title:"".concat((0,K.formatMessage)({id:"enterpriseColony.addCluster.host.Initialize_and_start"}),"\n            ").concat(s?P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.to_configure"}):P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.install"}),"\n            ").concat((0,K.formatMessage)({id:"enterpriseColony.addCluster.host.Cluster"})),confirmLoading:I,className:A.default.TelescopicModal,width:900,visible:!0,footer:[P.default.createElement(c.default,{key:"back",onClick:()=>{this.handleCheck(!1)}},P.default.createElement(K.FormattedMessage,{id:"button.cancel"})),P.default.createElement(c.default,{key:"link",type:"primary",onClick:()=>{this.setState({loading:!0},()=>{this.handleTabs("1"===T?"2":"1",!0)})},disabled:N},!V&&P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.on_all_nodes",values:{countContent:O}})||P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.executed_the_above"}))]},P.default.createElement(o.default,{style:{padding:"0 16px"}},P.default.createElement("span",{style:{fontWeight:600,color:"red"}},P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.start_at"}),s?P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.before_configuration"}):P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.All_before_installation"}),P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.soud"})),P.default.createElement(i.default,{span:24,style:{marginTop:"16px"}},P.default.createElement("span",{className:A.default.cmd},P.default.createElement(u.default,{className:A.default.copy,type:"copy",onClick:()=>{(0,F.default)(S),f.default.success({message:(0,K.formatMessage)({id:"notification.success.copy"})})}}),l&&7===l&&m({tit:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.Initialization"}),send:!0,configName:"nodeInitialization",handleClick:()=>{(0,F.default)(S),this.handleCountDown()},handleClosed:()=>{this.handleCountDown()},desc:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.complete"}),prevStep:!1,btnText:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.copy"}),nextStep:8,conPosition:{left:"0",bottom:"-156px"},svgPosition:{right:"-20px",marginTop:"-11px"}}),S)))),s&&P.default.createElement(n.default,{type:"warning",message:P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.suitable"})}),P.default.createElement(k.default,null,P.default.createElement(o.default,null,P.default.createElement(i.default,{span:24,style:{padding:"16px"}},P.default.createElement(R,{className:A.default.describe,style:l&&3===l&&J||{}},P.default.createElement("ul",null,P.default.createElement("li",null,P.default.createElement("span",null,P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.provided_hosts"}))),P.default.createElement("li",null,P.default.createElement("span",null,P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.provided_host"}),!s&&P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.and_ip"}),P.default.createElement("b",null,P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.and_ssh"})),P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.and"}),P.default.createElement("b",null,P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.port"})),P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.visit"}))),P.default.createElement("li",null,P.default.createElement("span",null,P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.script"}),P.default.createElement("b",null,P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.System_check"})),"\u3001",P.default.createElement("b",null,P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.secret_free"})),"\u3001",P.default.createElement("b",null,P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.docker"})),P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.movements"}))),P.default.createElement("li",null,P.default.createElement("span",null,P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.already_installed"}),P.default.createElement("b",null,"19.03.x")," ",P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.adn_lower_than"}),P.default.createElement("b",null,"1.13.x")," ",P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.edition"}))))),l&&3===l&&m&&U&&0===U.length&&P.default.createElement(P.Fragment,null,m({tit:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.matters_attention"}),send:!1,configName:"kclustersAttention",showSvg:!1,showArrow:!0,desc:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.explain"}),nextStep:4,conPosition:{right:"15px",bottom:"-134px"}})))),!s&&P.default.createElement(o.default,null,P.default.createElement(i.default,{span:12,style:{padding:l&&4===l?"":"0 16px"}},P.default.createElement(k.default.Item,{label:P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.name_Cluster"}),style:l&&4===l&&Object.assign({},{padding:"0 16px"},J)||{}},C("name",{initialValue:"",rules:[{required:!0,message:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.required"})},{pattern:/^[a-z0-9A-Z-]+$/,message:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.supported"})},{max:24,message:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.max"})}]})(P.default.createElement(g.default,{placeholder:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.only"}),style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}}))),l&&4===l&&m&&U&&0===U.length&&P.default.createElement(P.Fragment,null,m({tit:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.input_name"}),showSvg:!1,showArrow:!0,send:!1,configName:"kclustersAttention",desc:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.configuration_information"}),nextStep:5,conPosition:{marginTop:"-22px"}})))),P.default.createElement(_.default,{activeKey:T,onChange:e=>{this.handleTabs(e)}},P.default.createElement(B,{tab:P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.Visual_configuration"}),key:"1"},P.default.createElement("div",null,P.default.createElement(o.default,null,P.default.createElement(i.default,{span:24,style:{padding:"0 16px"}},P.default.createElement(k.default.Item,{label:P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.list"}),style:l&&5===l&&Object.assign({},{padding:"0 16px"},J)||{}},C("nodeLists",{initialValue:""})(P.default.createElement(r.default,{dataSource:w,columns:G,components:X,bordered:!0,rowClassName:()=>"editable-row",pagination:!1}))),P.default.createElement(c.default,{onClick:this.handleAdd,style:{marginBottom:16}},P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.add_node"})))))),P.default.createElement(B,{tab:P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.Custom_configuration"}),key:"2"})),l&&5===l&&m&&U&&0===U.length&&P.default.createElement(P.Fragment,null,m({tit:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.Fill_in_node"}),showSvg:!1,showArrow:!0,send:!1,configName:"kclustersAttention",desc:(0,K.formatMessage)({id:"enterpriseColony.addCluster.host.configuration_information"}),nextStep:6,conPosition:{bottom:"-14px",left:"39px"}})),P.default.createElement("div",{style:{display:"1"===T?"none":"block"}},(s&&"2"===T||!s)&&P.default.createElement(D.default,{help:M,data:L||"",label:P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.RKE_cluste_configuration"}),bg:"151718",width:"100%",marginTop:120,setFieldsValue:E,formItemLayout:q,Form:k.default,getFieldDecorator:C,beforeUpload:this.beforeUpload,mode:"yaml",name:"yamls",message:P.default.createElement(K.FormattedMessage,{id:"enterpriseColony.addCluster.host.input_rke"})}))))}},w=S))||w)||w);t.default=X}).call(this,a("tjlA").Buffer)},sQyZ:function(e,t,a){"use strict";var s=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var r=s(a("kLXV"));a("14J3");var n=s(a("BMrR"));a("giR+");var d=s(a("fyUT"));a("5NDa");var o=s(a("5rEg"));a("jCWc");var i=s(a("kPKH")),u=s(a("p0pE"));a("y8nQ");var c=s(a("Vl3Y"));a("OaEy");var h=s(a("2fM7"));a("tU7J");var p,m,f,C,g=s(a("wFql")),E=a("MuoO"),y=l(a("q1tI")),v=s(a("AklW")),k=s(a("dBUJ")),b=g.default.Paragraph,_=h.default.Option,M=(p=c.default.create(),m=(0,E.connect)(),p(f=m((C=class extends y.PureComponent{constructor(e){super(e),this.createCluster=(()=>{var e=this.props,t=e.form,a=e.dispatch,s=e.eid,l=e.onOK;t.validateFields((e,t)=>{e||(this.setState({loading:!0}),a({type:"cloud/createKubernetesCluster",payload:(0,u.default)({enterprise_id:s,provider_name:"ack"},t),callback:e=>{e&&l&&l(e)},handleError:e=>{e&&e.data&&7005===e.data.code?l(e.data.data):(v.default.handleCloudAPIError(e),this.setState({loading:!1}))}}))})}),this.changeWorkerType=(e=>{""===e&&this.setState({customResource:!0})}),this.state={customResource:!1,loading:!1}}render(){var e=this.props.onCancel,t=this.props.form.getFieldDecorator,a=this.state,s=a.customResource,l=a.loading;return y.default.createElement(r.default,{visible:!0,title:"\u8d2d\u4e70\u963f\u91cc\u4e91 ACK \u96c6\u7fa4",onOk:this.createCluster,width:800,confirmLoading:l,onCancel:e},y.default.createElement(c.default,null,y.default.createElement(n.default,null,y.default.createElement(i.default,{span:24,style:{padding:"16px"}},y.default.createElement(b,{className:k.default.describe},y.default.createElement("ul",null,y.default.createElement("li",null,y.default.createElement("span",null,"\u59d4\u6258\u8d2d\u4e70\u65f6\u5c06\u8d2d\u4e70\u4ee5\u4e0b\u8d44\u6e90\uff1a\u6807\u51c6\u6258\u7ba1\u96c6\u7fa4(1\u4e2a)\u3001VPC(1\u4e2a)")),y.default.createElement("li",null,y.default.createElement("span",null,"\u65b0\u8d2d\u96c6\u7fa4\u90fd\u5c06\u91c7\u7528\u6309\u9700\u540e\u4ed8\u8d39\u6a21\u5f0f\uff0c\u56e0\u6b64\u8bf7\u786e\u4fdd\u4f60\u7684\u963f\u91cc\u4e91\u8d26\u53f7\u80fd\u591f\u8fdb\u884c\u6309\u9700\u8d2d\u4e70\u8d44\u6e90")),y.default.createElement("li",null,y.default.createElement("span",null,"\u8d2d\u4e70\u7684Kubernetes\u5c06\u5f00\u542fEIP,\u901a\u8fc7\u516c\u7f51\u8bbf\u95eeKubeApiserver, \u96c6\u7fa4\u5bf9\u63a5\u5b8c\u6bd5\u540e\u53ef\u4ee5\u624b\u5de5\u5173\u95ed\u96c6\u7fa4\u7684\u5916\u7f51\u8bbf\u95eeEIP")),y.default.createElement("li",null,y.default.createElement("span",null,"\u9ed8\u8ba4\u91c7\u7528\u63a8\u8350\u7684\u8d44\u6e90\u7c7b\u578b\u914d\u7f6e\uff0c\u82e5\u4e0d\u7b26\u5408\u4f60\u7684\u9884\u671f\uff0c\u4f60\u53ef\u76f4\u63a5\u524d\u5f80\u963f\u91cc\u4e91\u63a7\u5236\u53f0\u81ea\u5b9a\u4e49\u8d2d\u4e70\u6258\u7ba1\u96c6\u7fa4\uff0c\u7136\u540e\u8fd4\u56de\u5230\u96c6\u7fa4\u5217\u8868\u9009\u62e9\u540e\u5f00\u59cb\u521d\u59cb\u5316")),y.default.createElement("li",null,y.default.createElement("span",null,"\u8d2d\u4e70\u96c6\u7fa4\u7684\u6210\u529f\u6027\u548c\u8017\u65f6\u53d6\u51b3\u4e8e\u963f\u91cc\u4e91\u7684\u5b9e\u9645\u72b6\u6001\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\u9884\u8ba110\u5206\u949f\u53ef\u4ee5\u5b8c\u6210\u96c6\u7fa4\u8d2d\u4e70")),s&&y.default.createElement("li",null,y.default.createElement("span",null,"\u81ea\u5b9a\u4e49\u8d44\u6e90\u89c4\u683c\u65f6\u8bf7\u53c2\u8003"," ",y.default.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://ecs-buy.aliyun.com/instanceTypes"},"\u963f\u91cc\u4e91ECS\u89c4\u683c\u8bf4\u660e\u6587\u6863")," ","\u83b7\u53d6\u8d44\u6e90\u89c4\u683cID"))))),y.default.createElement(i.default,{span:12,style:{padding:"0 16px"}},y.default.createElement(c.default.Item,{label:"\u533a\u57df"},t("region",{initialValue:"cn-hangzhou",rules:[{required:!0,message:"\u96c6\u7fa4\u521b\u5efa\u533a\u57df\u5fc5\u9009"}]})(y.default.createElement(h.default,{placeholder:"\u533a\u57df",getPopupContainer:e=>e.parentNode},v.default.getAllAliyunRegions().map(e=>{return y.default.createElement(_,{key:e.RegionId,value:e.RegionId},e.LocalName)}))))),y.default.createElement(i.default,{span:12,style:{padding:"0 16px"}},y.default.createElement(c.default.Item,{label:"\u540d\u79f0"},t("name",{initialValue:"",rules:[{required:!0,message:"\u96c6\u7fa4\u540d\u79f0\u5fc5\u586b"},{pattern:/^[a-z0-9A-Z-]+$/,message:"\u53ea\u652f\u6301\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u4e2d\u5212\u7ebf\u7ec4\u5408"},{max:24,message:"\u6700\u5927\u957f\u5ea624\u4f4d"}]})(y.default.createElement(o.default,{placeholder:"\u96c6\u7fa4\u540d\u79f0,\u8bf7\u786e\u4fdd\u5176\u4fdd\u6301\u552f\u4e00"})))),y.default.createElement(i.default,{span:12,style:{padding:"0 16px"}},!s&&y.default.createElement(c.default.Item,{label:"\u8d44\u6e90\u914d\u7f6e"},t("resourceType",{initialValue:"ecs.g5.xlarge",rules:[{required:!0,message:"\u8d44\u6e90\u914d\u7f6e\u5fc5\u987b\u6307\u5b9a"}]})(y.default.createElement(h.default,{getPopupContainer:e=>e.parentNode,onChange:this.changeWorkerType,placeholder:"\u96c6\u7fa4\u540d\u79f0"},y.default.createElement(_,{value:"ecs.g5.large"},"\u6700\u5c0f\u914d\u7f6e\uff08\u5355\u8282\u70b92Core/8GB RAM, \u6309\u9700\u9884\u8ba12\u5143/\u5c0f\u65f6\uff09"),y.default.createElement(_,{value:"ecs.g5.xlarge"},"\u666e\u901a\u914d\u7f6e\uff08\u5355\u8282\u70b94Core/16GB RAM, \u6309\u9700\u9884\u8ba14\u5143/\u5c0f\u65f6\uff09"),y.default.createElement(_,{value:"ecs.g5.2xlarge"},"\u751f\u4ea7\u914d\u7f6e\uff08\u5355\u8282\u70b98Core/32GB RAM, \u6309\u9700\u9884\u8ba18\u5143/\u5c0f\u65f6\uff09"),y.default.createElement(_,{value:""},"\u81ea\u5b9a\u4e49")))),s&&y.default.createElement(c.default.Item,{label:"\u8d44\u6e90\u914d\u7f6e"},t("resourceType",{initialValue:"",rules:[{required:!0,message:"\u8d44\u6e90\u914d\u7f6e\u5fc5\u987b\u6307\u5b9a"},{pattern:/^[a-z0-9A-Z.]+$/,message:"\u8bf7\u786e\u5b9a\u8d44\u6e90\u914d\u7f6e\u89c4\u683c\u662f\u5426\u5408\u6cd5"}]})(y.default.createElement(o.default,{placeholder:"\u963f\u91cc\u4e91ECS\u89c4\u683c"})))),y.default.createElement(i.default,{span:12,style:{padding:"0 16px"}},y.default.createElement(c.default.Item,{label:"\u8282\u70b9\u6570\u91cf"},t("workerNum",{initialValue:2,rules:[{required:!0,message:"\u8282\u70b9\u6570\u91cf\u5fc5\u987b\u6307\u5b9a"}]})(y.default.createElement(d.default,{style:{width:"100%"},min:2,placeholder:"\u8282\u70b9\u6570\u91cf"})))))))}},f=C))||f)||f);t.default=M}}]);